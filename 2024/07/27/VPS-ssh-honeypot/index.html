<!DOCTYPE html>
<html lang="en">
    
    <style>
        body
        {
            font-family: "Times New Roman", Helvetica, Tahoma, Arial,   LXGW WenKai   "notoserifsc-medium", "Microsoft YaHei", "Hiragino Sans GB", "WenQuanYi Micro Hei", sans-serif !important;

        }
    </style>

    <head>
    <meta charset="utf-8">
    <meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover" name="viewport" />
    <meta name="description" content="VPS - SSHèœœç½æ­å»º" />
    <meta name="hexo-theme-A4" content="v1.9.6" />
    <link rel="alternate icon" type="image/webp" href="/img/favicon.webp">
    <title>Jay1anğŸˆ</title>

    
        
<link rel="stylesheet" href="/css/highlight/style1.css">

        
<link rel="stylesheet" href="/css/reset.css">

        
<link rel="stylesheet" href="/css/markdown.css">

        
<link rel="stylesheet" href="/css/fonts.css">
 
         <!--æ³¨æ„ï¼šé¦–é¡µæ—¢ä¸æ˜¯postä¹Ÿä¸æ˜¯page-->
        
        
        
<link rel="stylesheet" href="/css/ui.css">
 
        
<link rel="stylesheet" href="/css/style.css">


        
            <!--è¿”å›é¡¶éƒ¨css-->
            
<link rel="stylesheet" href="/css/returnToTop.css">

            
<link rel="stylesheet" href="/css/unicons.css">

        
        
            <!--ç›®å½•-->
            
<link rel="stylesheet" href="/css/toc.css">

        
    

    
        
<link rel="stylesheet" href="/css/returnToLastPage.css">

    
    
   
<link rel="stylesheet" href="/css/lightgallery-bundle.min.css">


<meta name="generator" content="Hexo 7.3.0"></head>
    
    

    
    



    

    
    

    
    
    
    <body>
        <script src="/js/darkmode-js.min.js"></script>
        
        <script>
            const options = {
                bottom: '40px', // default: '32px'
                right: 'unset', // default: '32px'
                left: '42px', // default: 'unset'
                time: '0.3s', // default: '0.3s'
                mixColor: '#fff', // default: '#fff'
                backgroundColor: ' #e4e4e4 ',  // default: '#fff'
                buttonColorDark: '#100f2c',  // default: '#100f2c'
                buttonColorLight: '#fff', // default: '#fff'
                saveInCookies: true, // default: true,
                label: 'ğŸŒ“', // default: ''
                autoMatchOsTheme: true // default: true
            }
            const darkmode = new Darkmode(options);
            darkmode.showWidget();
        </script>
        
        
            <div class="left-toc-container">
                <nav id="toc" class="bs-docs-sidebar"></nav>
            </div>
        
        <div class="paper">
            
            
            
            
                <div class="shadow-drop-2-bottom paper-main">
                    


<div class="header">
    <div class="header-container">
        <img style="
        width: 56px;
        height: auto;" alt="^-^" cache-control="max-age=86400" class="header-img" src="/img/favicon.webp" width="10%"></img>
        <div class="header-content">
            <a class="logo" href="/">Jay1anğŸˆ</a> 
            <span class="description">I am who I am.</span> 
        </div>
        
    </div>
    
   
    <ul class="nav">
        
            
                <li><a href="/">â›©ï¸é¦–é¡µ</a></li>
            
        
            
                <li><a href="/list/">ğŸ—’ï¸æ–‡ç« </a></li>
            
        
            
                <li><a href="/categories/">ğŸ·ï¸åˆ†ç±»</a></li>
            
        
            
                <li><a href="/about/">ğŸ¨å…³äº</a></li>
            
        
            
                <li><a href="/now/">ğŸ¡Now</a></li>
            
        
    </ul>
</div> 
        
                    
                    

                    
                    
                    
                    <!--è¯´æ˜æ˜¯æ–‡ç« posté¡µé¢-->
                    
                        <div class="post-main">
    

    
        
            
                <div class="post-main-title" style="text-align: center;">
                    VPS - SSHèœœç½æ­å»º
                </div>
            
        
      
    

    

        
            <div class="post-head-meta-center">
        
                
                    <span>æœ€è¿‘æ›´æ–°ï¼š2024-07-29</span> 
                
                
                    
                        &nbsp; | &nbsp;
                    
                     <span>å­—æ•°æ€»è®¡ï¼š5.1k</span>
                
                
                    
                        &nbsp; | &nbsp;
                    
                    <span>é˜…è¯»ä¼°æ—¶ï¼š22åˆ†é’Ÿ</span>
                
                
                    
                        &nbsp; | &nbsp;
                    
                    <span id="busuanzi_container_page_pv">
                        é˜…è¯»é‡ï¼š<span id="busuanzi_value_page_pv"></span>æ¬¡
                    </span>
                
            </div>
    

    <div class="post-md">
        
            
                <ol class="post-toc"><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#VPS-SSH%E8%9C%9C%E7%BD%90%E6%90%AD%E5%BB%BA"><span class="post-toc-text">VPS - SSHèœœç½æ­å»º</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#%E5%B7%A5%E4%BD%9C%E5%8A%A8%E6%9C%BA"><span class="post-toc-text">å·¥ä½œåŠ¨æœº</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#%E8%83%8C%E6%99%AF"><span class="post-toc-text">èƒŒæ™¯</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#%E6%9F%A5%E7%9C%8B%E6%97%A5%E5%BF%97%E6%83%85%E5%86%B5"><span class="post-toc-text">æŸ¥çœ‹æ—¥å¿—æƒ…å†µ</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#auth-log%E6%96%87%E4%BB%B6%E4%BB%8B%E7%BB%8D"><span class="post-toc-text">auth.logæ–‡ä»¶ä»‹ç»</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#%E6%9F%A5%E7%9C%8Bauth-log%E6%96%87%E4%BB%B6%E5%86%85%E5%AE%B9"><span class="post-toc-text">æŸ¥çœ‹auth.logæ–‡ä»¶å†…å®¹</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-5"><a class="post-toc-link" href="#%E4%BD%BF%E7%94%A8grep%E5%91%BD%E4%BB%A4%E7%AD%9B%E9%80%89SSH%E5%A4%B1%E8%B4%A5%E8%BF%9E%E6%8E%A5"><span class="post-toc-text">ä½¿ç”¨grepå‘½ä»¤ç­›é€‰SSHå¤±è´¥è¿æ¥</span></a></li><li class="post-toc-item post-toc-level-5"><a class="post-toc-link" href="#%E4%BD%BF%E7%94%A8python%E8%84%9A%E6%9C%AC%E5%A4%84%E7%90%86%E6%97%A5%E5%BF%97%E6%95%B0%E6%8D%AE"><span class="post-toc-text">ä½¿ç”¨pythonè„šæœ¬å¤„ç†æ—¥å¿—æ•°æ®</span></a></li></ol></li></ol></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#%E4%B8%BA%E4%BB%80%E4%B9%88%E8%A6%81%E6%90%AD%E5%BB%BA%E8%9C%9C%E7%BD%90"><span class="post-toc-text">ä¸ºä»€ä¹ˆè¦æ­å»ºèœœç½</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#%E5%8F%AF%E8%83%BD%E7%9A%84%E8%A7%A3%E5%86%B3%E5%8A%9E%E6%B3%95"><span class="post-toc-text">å¯èƒ½çš„è§£å†³åŠæ³•</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#%E4%B8%BA%E4%BB%80%E4%B9%88%E8%A6%81%E6%90%AD%E5%BB%BA%E8%9C%9C%E7%BD%90-1"><span class="post-toc-text">ä¸ºä»€ä¹ˆè¦æ­å»ºèœœç½</span></a></li></ol></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#%E8%9C%9C%E7%BD%90%E6%90%AD%E5%BB%BA"><span class="post-toc-text">èœœç½æ­å»º</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#%E5%B7%A5%E4%BD%9C%E5%87%86%E5%A4%87"><span class="post-toc-text">å·¥ä½œå‡†å¤‡</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#%E7%BC%96%E8%BE%91docker-compose-yml"><span class="post-toc-text">ç¼–è¾‘docker-compose.yml</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#%E7%BC%96%E8%BE%91cowire%E9%85%8D%E7%BD%AE"><span class="post-toc-text">ç¼–è¾‘cowireé…ç½®</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#%E4%BD%BF%E7%94%A8docker-compose%E6%9E%84%E5%BB%BA%E5%B9%B6%E5%90%AF%E5%8A%A8%E5%AE%B9%E5%99%A8"><span class="post-toc-text">ä½¿ç”¨docker-composeæ„å»ºå¹¶å¯åŠ¨å®¹å™¨</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#%E9%85%8D%E7%BD%AEMySQL%E6%95%B0%E6%8D%AE%E5%BA%93"><span class="post-toc-text">é…ç½®MySQLæ•°æ®åº“</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#%E9%87%8D%E6%96%B0%E9%85%8D%E7%BD%AE%E7%AB%AF%E5%8F%A3"><span class="post-toc-text">é‡æ–°é…ç½®ç«¯å£</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#%E4%BF%AE%E6%94%B9SSH%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E4%BB%A5%E5%90%AF%E7%94%A8%E6%96%B0%E7%9A%84%E7%AB%AF%E5%8F%A3"><span class="post-toc-text">ä¿®æ”¹SSHé…ç½®æ–‡ä»¶ä»¥å¯ç”¨æ–°çš„ç«¯å£</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#%E9%85%8D%E7%BD%AEiptables%E8%BF%9B%E8%A1%8C%E7%AB%AF%E5%8F%A3%E9%87%8D%E5%AE%9A%E5%90%91"><span class="post-toc-text">é…ç½®iptablesè¿›è¡Œç«¯å£é‡å®šå‘</span></a></li></ol></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#%E6%95%88%E6%9E%9C"><span class="post-toc-text">æ•ˆæœ</span></a></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#%E5%8F%82%E8%80%83%E6%96%87%E6%A1%A3"><span class="post-toc-text">å‚è€ƒæ–‡æ¡£</span></a></li></ol></li></ol>
            
        
        <div class=".article-gallery"><h1 id="VPS-SSHèœœç½æ­å»º"><a href="#VPS-SSHèœœç½æ­å»º" class="headerlink" title="VPS - SSHèœœç½æ­å»º"></a>VPS - SSHèœœç½æ­å»º</h1><h2 id="å·¥ä½œåŠ¨æœº"><a href="#å·¥ä½œåŠ¨æœº" class="headerlink" title="å·¥ä½œåŠ¨æœº"></a>å·¥ä½œåŠ¨æœº</h2><h3 id="èƒŒæ™¯"><a href="#èƒŒæ™¯" class="headerlink" title="èƒŒæ™¯"></a>èƒŒæ™¯</h3><p>æˆ‘çš„æœåŠ¡å™¨22ç«¯å£å¯¹æ‰€æœ‰IPå¼€æ”¾ï¼Œä»»ä½•IPéƒ½å¯ä»¥è¿æ¥åˆ°æˆ‘çš„SSHæœåŠ¡ã€‚</p>
<blockquote>
<p>æœåŠ¡å™¨çš„ç³»ç»Ÿä¸º Ubuntu </p>
</blockquote>
<h3 id="æŸ¥çœ‹æ—¥å¿—æƒ…å†µ"><a href="#æŸ¥çœ‹æ—¥å¿—æƒ…å†µ" class="headerlink" title="æŸ¥çœ‹æ—¥å¿—æƒ…å†µ"></a>æŸ¥çœ‹æ—¥å¿—æƒ…å†µ</h3><p>åœ¨æŸ¥çœ‹æ—¥å¿—æ—¶å‘ç°æœ‰è®¸å¤šè¿æ¥å¤±è´¥çš„å°è¯•ï¼Œè¡¨æ˜æˆ‘çš„VPSå—åˆ°äº†SSHæš´åŠ›ç ´è§£æ”»å‡»ã€‚</p>
<h4 id="auth-logæ–‡ä»¶ä»‹ç»"><a href="#auth-logæ–‡ä»¶ä»‹ç»" class="headerlink" title="auth.logæ–‡ä»¶ä»‹ç»"></a>auth.logæ–‡ä»¶ä»‹ç»</h4><p><code>auth.log</code> æ–‡ä»¶æ˜¯Linuxç³»ç»Ÿä¸­ç”¨äºè®°å½•èº«ä»½éªŒè¯ç›¸å…³äº‹ä»¶çš„æ—¥å¿—æ–‡ä»¶ã€‚å®ƒåŒ…å«ç³»ç»Ÿå¯åŠ¨ã€ç™»å½•å°è¯•ã€æˆåŠŸå’Œå¤±è´¥çš„èº«ä»½éªŒè¯äº‹ä»¶ä»¥åŠSSHè¿æ¥å°è¯•ç­‰ä¿¡æ¯ã€‚</p>
<p>è¯¥æ–‡ä»¶ä½äº<code>/var/log/</code>ç›®å½•ä¸‹ã€‚</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">ls</span> /var/log/</span><br><span class="line">alternatives.log  auth.log.1     chrony                 dmesg     kern.log       lastlog   syslog.2.gz</span><br><span class="line">apache2           auth.log.2.gz  cloud-init-output.log  dmesg.0   kern.log.1     private   unattended-upgrades</span><br><span class="line">apt               azure          cloud-init.log         dpkg.log  kern.log.2.gz  syslog    waagent.log</span><br><span class="line">auth.log          btmp           dist-upgrade           journal   landscape      syslog.1  wtmp</span><br></pre></td></tr></table></figure>

<h4 id="æŸ¥çœ‹auth-logæ–‡ä»¶å†…å®¹"><a href="#æŸ¥çœ‹auth-logæ–‡ä»¶å†…å®¹" class="headerlink" title="æŸ¥çœ‹auth.logæ–‡ä»¶å†…å®¹"></a>æŸ¥çœ‹auth.logæ–‡ä»¶å†…å®¹</h4><p>é€šè¿‡æŸ¥çœ‹ <code>auth.log</code> æ–‡ä»¶ä¸­çš„å†…å®¹ï¼Œå¯ä»¥äº†è§£ç³»ç»Ÿçš„ç™»å½•æ´»åŠ¨ï¼Œå°¤å…¶æ˜¯è¯†åˆ«å‡ºå¤±è´¥çš„ç™»å½•å°è¯•ï¼Œå¯èƒ½æ˜¯æ¶æ„æ”»å‡»çš„è¿¹è±¡ã€‚</p>
<p><code>auth.log</code>æ–‡ä»¶ä¸­å¯èƒ½åŒ…å«ä»¥ä¸‹æ ¼å¼çš„æ•°æ®ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">Jul 26 07:08:12 Azure-jay1an SSHd[130241]: Failed password for root from 119.202.128.28 port 33216 SSH2</span><br><span class="line">Jul 26 07:09:01 Azure-jay1an SSHd[130247]: Failed password for invalid user testuser from 119.202.128.28 port 50334 SSH2</span><br><span class="line">Jul 26 07:10:07 Azure-jay1an SSHd[130255]: Accepted password for user from 192.168.1.2 port 52326 SSH2</span><br><span class="line">Jul 26 07:11:30 Azure-jay1an SSHd[130274]: Accepted publickey for admin from 203.0.113.42 port 51422 SSH2: RSA SHA256:...</span><br><span class="line">Jul 26 07:12:22 Azure-jay1an SSHd[130284]: Failed publickey for root from 203.0.113.57 port 58231 SSH2: RSA SHA256:...</span><br><span class="line">Jul 26 07:13:45 Azure-jay1an SSHd[130297]: Connection closed by 192.168.1.3 port 51130 [preauth]</span><br><span class="line">Jul 26 07:14:11 Azure-jay1an SSHd[130308]: pam_unix(SSHd:session): session opened for user root by (uid=0)</span><br><span class="line">Jul 26 07:15:09 Azure-jay1an SSHd[130318]: pam_unix(SSHd:session): session closed for user root</span><br><span class="line">Jul 26 07:16:47 Azure-jay1an SSHd[130330]: Received disconnect from 198.51.100.14 port 53332:11: disconnected by user</span><br><span class="line">Jul 26 07:17:33 Azure-jay1an SSHd[130338]: Received signal 15; terminating.</span><br><span class="line">Jul 26 07:18:05 Azure-jay1an sudo: pam_unix(sudo:session): session opened for user root by someuser(uid=1000)</span><br><span class="line">Jul 26 07:18:32 Azure-jay1an sudo: someuser : TTY=pts/1 ; PWD=/home/someuser ; USER=root ; COMMAND=/bin/ls</span><br><span class="line">Jul 26 07:19:07 Azure-jay1an sudo: pam_unix(sudo:session): session closed for user root</span><br><span class="line">Jul 26 07:20:01 Azure-jay1an CRON[130350]: pam_unix(cron:session): session opened for user root by (uid=0)</span><br><span class="line">Jul 26 07:21:05 Azure-jay1an CRON[130350]: pam_unix(cron:session): session closed for user root</span><br><span class="line">Jul 26 07:21:45 Azure-jay1an SSHd[130360]: Invalid user guest from 198.51.100.7 port 60934</span><br><span class="line">Jul 26 07:22:23 Azure-jay1an SSHd[130362]: Failed keyboard-interactive/pam for invalid user guest from 198.51.100.7 port 60934 SSH2</span><br><span class="line">Jul 26 07:23:11 Azure-jay1an su[130374]: pam_unix(su:session): session opened for user root by someuser(uid=1000)</span><br><span class="line">Jul 26 07:24:09 Azure-jay1an su[130374]: pam_unix(su:session): session closed for user root</span><br><span class="line">Jul 26 07:25:10 Azure-jay1an gnome-keyring-daemon[130390]: The SSH agent was already initialized</span><br></pre></td></tr></table></figure>

<p>æ¯ä¸€æ¡è®°å½•é€šå¸¸éƒ½åŒ…å«ä»¥ä¸‹å‡ ä¸ªéƒ¨åˆ†ï¼š</p>
<p><strong>æ—¥æœŸå’Œæ—¶é—´</strong>ï¼šæ—¥å¿—æ¡ç›®ç”Ÿæˆçš„æ—¥æœŸå’Œæ—¶é—´ã€‚</p>
<p><strong>ä¸»æœºå</strong>ï¼šæ—¥å¿—ç”Ÿæˆçš„è®¡ç®—æœºåç§°ã€‚</p>
<p><strong>æœåŠ¡åå’Œè¿›ç¨‹ID</strong>ï¼šäº§ç”Ÿæ—¥å¿—çš„æœåŠ¡åç§°å’Œè¿›ç¨‹IDã€‚</p>
<p><strong>æ¶ˆæ¯å†…å®¹</strong>ï¼šæè¿°äº‹ä»¶çš„è¯¦ç»†ä¿¡æ¯ã€‚</p>
<p>ç¤ºä¾‹ï¼š</p>
<figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Jul 26 07:08:12 Azure-jay1an SSHd[130241]: Failed password for root from 119.202.128.28 port 33216 SSH2</span><br></pre></td></tr></table></figure>

<p><code>Jul 26 07:08:12</code>ï¼šæ—¥æœŸå’Œæ—¶é—´</p>
<p><code>Azure-jay1an</code>ï¼šä¸»æœºå</p>
<p><code>SSHd[130247]</code> ï¼šæœåŠ¡å <code>SSHd</code> å’Œè¿›ç¨‹ID <code>130241</code></p>
<p><code>Failed password for root from 119.202.128.28 port 33216 SSH2</code>ï¼šæ¶ˆæ¯å†…å®¹ï¼Œè¡¨ç¤º<code>119.202.128.28</code>ä¸»æœºä½¿ç”¨<code>root</code>è´¦å·ç™»é™†å¤±è´¥ã€‚</p>
<h5 id="ä½¿ç”¨grepå‘½ä»¤ç­›é€‰SSHå¤±è´¥è¿æ¥"><a href="#ä½¿ç”¨grepå‘½ä»¤ç­›é€‰SSHå¤±è´¥è¿æ¥" class="headerlink" title="ä½¿ç”¨grepå‘½ä»¤ç­›é€‰SSHå¤±è´¥è¿æ¥"></a>ä½¿ç”¨grepå‘½ä»¤ç­›é€‰SSHå¤±è´¥è¿æ¥</h5><p>å¯ä»¥ä½¿ç”¨<code>grep</code>å‘½ä»¤ç­›é€‰å‡ºé€šè¿‡SSHæ‰€æœ‰å¤±è´¥çš„è¿æ¥å°è¯•è®°å½•ã€‚</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">grep <span class="string">&#x27;SSHd.*Failed password&#x27;</span> /var/log/auth.log</span><br></pre></td></tr></table></figure>

<p>è¿è¡Œè¯¥å‘½ä»¤åï¼Œç»ˆç«¯æ‰“å°å‡ºå¾ˆå¤šçš„ä¿¡æ¯ï¼Œè¡¨æ˜æœ‰å¾ˆå¤šä¸»æœºéƒ½åœ¨å°è¯•æš´åŠ›ç ´è§£æˆ‘çš„SSHæœåŠ¡ã€‚</p>
<p>ä¸€éƒ¨åˆ†è®°å½•å¦‚ä¸‹ï¼š</p>
<figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">Jul 26 07:13:07 Azure-jay1an SSHd[130272]: Failed password for invalid user devops from 187.251.123.99 port 35058 SSH2</span><br><span class="line">Jul 26 07:14:02 Azure-jay1an SSHd[130274]: Failed password for root from 187.251.123.99 port 54888 SSH2</span><br><span class="line">Jul 26 07:21:20 Azure-jay1an SSHd[130286]: Failed password for invalid user admin from 111.70.9.148 port 60815 SSH2</span><br><span class="line">Jul 26 07:23:37 Azure-jay1an SSHd[130293]: Failed password for invalid user admin from 208.48.253.178 port 58872 SSH2</span><br><span class="line">Jul 26 07:23:43 Azure-jay1an SSHd[130297]: Failed password for invalid user admin from 60.167.19.30 port 59719 SSH2</span><br><span class="line">Jul 26 07:30:10 Azure-jay1an SSHd[131231]: Failed password for invalid user config from 116.235.180.116 port 48617 SSH2</span><br><span class="line">Jul 26 07:37:17 Azure-jay1an SSHd[131251]: Failed password for invalid user user from 118.218.209.149 port 52664 SSH2</span><br><span class="line">Jul 26 07:37:21 Azure-jay1an SSHd[131253]: Failed password for root from 104.248.129.160 port 44810 SSH2</span><br><span class="line">Jul 26 07:37:52 Azure-jay1an SSHd[131259]: Failed password for invalid user admin from 223.197.199.52 port 44007 SSH2</span><br><span class="line">Jul 27 09:58:27 Azure-jay1an SSHd[136025]: Failed password for root from 110.191.181.36 port 53809 SSH2</span><br></pre></td></tr></table></figure>

<h5 id="ä½¿ç”¨pythonè„šæœ¬å¤„ç†æ—¥å¿—æ•°æ®"><a href="#ä½¿ç”¨pythonè„šæœ¬å¤„ç†æ—¥å¿—æ•°æ®" class="headerlink" title="ä½¿ç”¨pythonè„šæœ¬å¤„ç†æ—¥å¿—æ•°æ®"></a>ä½¿ç”¨pythonè„šæœ¬å¤„ç†æ—¥å¿—æ•°æ®</h5><p>æœ¬æƒ³ä½¿ç”¨<code>awk</code>å‘½ä»¤æå–å‡º<code>IP</code>åœ°å€ï¼Œå¹¶ä½œä¸€äº›ç®€å•çš„ç»Ÿè®¡ï¼Œä½†æ˜¯æ—¥å¿—é‡Œçš„ä¿¡æ¯æ ¼å¼å¹¶ä¸æ˜¯ç‰¹åˆ«ç»Ÿä¸€ï¼Œä¸ºäº†æ–¹ä¾¿èµ·è§ï¼Œè¿˜æ˜¯ä½¿ç”¨pythonè„šæœ¬å¤„ç†ã€‚</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> re</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"><span class="keyword">from</span> collections <span class="keyword">import</span> defaultdict</span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆå§‹åŒ–å­—å…¸</span></span><br><span class="line">user_attempts = defaultdict(<span class="built_in">int</span>)</span><br><span class="line">ip_attempts = defaultdict(<span class="built_in">int</span>)</span><br><span class="line">ip_cache = &#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ­£åˆ™è¡¨è¾¾å¼æ¨¡å¼</span></span><br><span class="line">user_pattern = re.<span class="built_in">compile</span>(<span class="string">r&#x27;Failed password for (invalid user )?(\w+)&#x27;</span>)</span><br><span class="line">ip_pattern = re.<span class="built_in">compile</span>(<span class="string">r&#x27;from ([\d\.]+)&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># è¯»å–auth.logæ–‡ä»¶</span></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;/var/log/auth.log&#x27;</span>, <span class="string">&#x27;r&#x27;</span>) <span class="keyword">as</span> file:</span><br><span class="line">    <span class="keyword">for</span> line <span class="keyword">in</span> file:</span><br><span class="line">        <span class="comment"># æŸ¥æ‰¾ç”¨æˆ·å</span></span><br><span class="line">        user_match = user_pattern.search(line)</span><br><span class="line">        <span class="keyword">if</span> user_match:</span><br><span class="line">            user = user_match.group(<span class="number">2</span>)</span><br><span class="line">            user_attempts[user] += <span class="number">1</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment"># æŸ¥æ‰¾IPåœ°å€</span></span><br><span class="line">        ip_match = ip_pattern.search(line)</span><br><span class="line">        <span class="keyword">if</span> ip_match:</span><br><span class="line">            ip = ip_match.group(<span class="number">1</span>)</span><br><span class="line">            ip_attempts[ip] += <span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ä»æ–‡ä»¶åŠ è½½ç¼“å­˜çš„IPä½ç½®ä¿¡æ¯</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">load_ip_cache</span>(<span class="params">filename=<span class="string">&#x27;ip_cache.json&#x27;</span></span>):</span><br><span class="line">    <span class="keyword">global</span> ip_cache</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="keyword">with</span> <span class="built_in">open</span>(filename, <span class="string">&#x27;r&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">            ip_cache = json.load(f)</span><br><span class="line">    <span class="keyword">except</span> FileNotFoundError:</span><br><span class="line">        ip_cache = &#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># å°†IPä½ç½®ä¿¡æ¯ç¼“å­˜åˆ°æ–‡ä»¶</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">save_ip_cache</span>(<span class="params">filename=<span class="string">&#x27;ip_cache.json&#x27;</span></span>):</span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(filename, <span class="string">&#x27;w&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">        json.dump(ip_cache, f)</span><br><span class="line"></span><br><span class="line"><span class="comment"># æŸ¥è¯¢IPåœ°å€çš„åœ°ç†ä½ç½®ä¿¡æ¯</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_ip_location</span>(<span class="params">ip</span>):</span><br><span class="line">    <span class="keyword">if</span> ip <span class="keyword">in</span> ip_cache:</span><br><span class="line">        <span class="keyword">return</span> ip_cache[ip]</span><br><span class="line">    response = requests.get(<span class="string">f&quot;https://ipinfo.io/<span class="subst">&#123;ip&#125;</span>/json&quot;</span>)</span><br><span class="line">    time.sleep(random.uniform(<span class="number">0.3</span>, <span class="number">1</span>))  <span class="comment"># æ·»åŠ éšæœºè¯·æ±‚é—´éš”ï¼Œé¿å…é¢‘ç¹è®¿é—®API</span></span><br><span class="line">    <span class="keyword">if</span> response.status_code == <span class="number">200</span>:</span><br><span class="line">        ip_cache[ip] = response.json()</span><br><span class="line">        <span class="keyword">return</span> ip_cache[ip]</span><br><span class="line">    <span class="keyword">return</span> &#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># åŠ è½½IPç¼“å­˜</span></span><br><span class="line">load_ip_cache()</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ‰“å°ç”¨æˆ·åå°è¯•æ¬¡æ•°</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;ç”¨æˆ·åå°è¯•æ¬¡æ•°:&quot;</span>)</span><br><span class="line"><span class="keyword">for</span> user, count <span class="keyword">in</span> <span class="built_in">sorted</span>(user_attempts.items(), key=<span class="keyword">lambda</span> item: item[<span class="number">1</span>], reverse=<span class="literal">True</span>):</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;<span class="subst">&#123;user&#125;</span>: <span class="subst">&#123;count&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;\nIPå°è¯•æ¬¡æ•°å’Œåœ°ç†ä½ç½®:&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ‰“å°IPå°è¯•æ¬¡æ•°ï¼Œå¹¶è·å–åœ°ç†ä½ç½®ä¿¡æ¯</span></span><br><span class="line"><span class="keyword">for</span> ip, count <span class="keyword">in</span> <span class="built_in">sorted</span>(ip_attempts.items(), key=<span class="keyword">lambda</span> item: item[<span class="number">1</span>], reverse=<span class="literal">True</span>):</span><br><span class="line">    <span class="keyword">if</span> count &gt; <span class="number">50</span>:</span><br><span class="line">        location_info = get_ip_location(ip)</span><br><span class="line">        location = location_info.get(<span class="string">&quot;city&quot;</span>, <span class="string">&quot;Unknown city&quot;</span>) + <span class="string">&quot;, &quot;</span> + location_info.get(<span class="string">&quot;region&quot;</span>, <span class="string">&quot;Unknown region&quot;</span>) + <span class="string">&quot;, &quot;</span> + location_info.get(<span class="string">&quot;country&quot;</span>, <span class="string">&quot;Unknown country&quot;</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;<span class="subst">&#123;ip&#125;</span>: <span class="subst">&#123;count&#125;</span> æ¬¡å°è¯• - ä½ç½®: <span class="subst">&#123;location&#125;</span>&quot;</span>)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;<span class="subst">&#123;ip&#125;</span>: <span class="subst">&#123;count&#125;</span> æ¬¡å°è¯•&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># ä¿å­˜IPç¼“å­˜</span></span><br><span class="line">save_ip_cache()</span><br></pre></td></tr></table></figure>

<p><strong>è¯¥è„šæœ¬ç”±ChatGPTç”Ÿæˆï¼Œå¯ä»¥ç»Ÿè®¡å“ªäº›ç”¨æˆ·åè¢«å°è¯•äº†ï¼Œå¤±è´¥äº†å¤šå°‘æ¬¡ï¼›å“ªäº›IPå°è¯•äº†ï¼Œå¤±è´¥äº†å¤šå°‘æ¬¡ã€‚åŒæ—¶ï¼Œä½¿ç”¨ç½‘ç»œä¸Šçš„ç°æˆAPIæŸ¥è¯¢IPåœ°å€çš„åœ°ç†ä½ç½®ã€‚</strong>ä¸ºäº†é¿å…å¯¹APIé¢‘ç¹çš„è¯·æ±‚ä»¥åŠé¿å…è¢«è¯†åˆ«æˆçˆ¬è™«ï¼Œè¿˜è®¾è®¡äº†ç®€å•çš„IPç¼“å­˜å¹¶åœ¨æ¯ä¸€æ¬¡è¯·æ±‚é—´éš”åŠ ä¸Šéšæœºå»¶æ—¶ã€‚</p>
<p>è„šæœ¬çš„è¿è¡Œç»“æœï¼ˆç®€ç•¥ç‰ˆï¼‰å¦‚ä¸‹ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">$ python3 SSH_login_attempts.py</span><br><span class="line">ç”¨æˆ·åå°è¯•æ¬¡æ•°:</span><br><span class="line">root: 20563</span><br><span class="line">admin: 929</span><br><span class="line">ubuntu: 487</span><br><span class="line">user: 451</span><br><span class="line"><span class="built_in">test</span>: 424</span><br><span class="line">ftpuser: 282</span><br><span class="line">oracle: 266</span><br><span class="line">debian: 194</span><br><span class="line">test1: 146</span><br><span class="line">ubnt: 134</span><br><span class="line">usuario: 134</span><br><span class="line">test2: 123</span><br><span class="line">postgres: 122</span><br><span class="line">deploy: 96</span><br><span class="line">git: 96</span><br><span class="line">pi: 93</span><br><span class="line">dev: 75</span><br><span class="line">guest: 75</span><br><span class="line">...</span><br><span class="line">IPå°è¯•æ¬¡æ•°å’Œåœ°ç†ä½ç½®:</span><br><span class="line">185.133.250.70: 5837 æ¬¡å°è¯• - ä½ç½®: Frankfurt am Main, Hesse, DE</span><br><span class="line">111.10.36.20: 2565 æ¬¡å°è¯• - ä½ç½®: Chongqing, Chongqing, CN</span><br><span class="line">38.6.164.6: 1689 æ¬¡å°è¯• - ä½ç½®: Hong Kong, Hong Kong, HK</span><br><span class="line">183.81.169.238: 1063 æ¬¡å°è¯• - ä½ç½®: Amsterdam, North Holland, NL</span><br><span class="line">209.38.25.214: 852 æ¬¡å°è¯• - ä½ç½®: Sydney, New South Wales, AU</span><br><span class="line">209.38.17.101: 848 æ¬¡å°è¯• - ä½ç½®: Sydney, New South Wales, AU</span><br><span class="line">117.144.99.175: 742 æ¬¡å°è¯• - ä½ç½®: Shanghai, Shanghai, CN</span><br><span class="line">170.64.142.212: 735 æ¬¡å°è¯• - ä½ç½®: Sydney, New South Wales, AU</span><br><span class="line">95.214.27.253: 488 æ¬¡å°è¯• - ä½ç½®: Kerkrade, Limburg, NL</span><br><span class="line">146.190.101.111: 466 æ¬¡å°è¯• - ä½ç½®: Singapore, Singapore, SG</span><br><span class="line">209.38.241.226: 327 æ¬¡å°è¯• - ä½ç½®: Frankfurt am Main, Hesse, DE</span><br><span class="line">193.32.162.65: 314 æ¬¡å°è¯• - ä½ç½®: Budapest, Budapest, HU</span><br><span class="line">156.251.135.252: 296 æ¬¡å°è¯• - ä½ç½®: Los Angeles, California, US</span><br><span class="line">91.92.245.92: 233 æ¬¡å°è¯• - ä½ç½®: Amsterdam, North Holland, NL</span><br><span class="line">192.180.14.56: 233 æ¬¡å°è¯• - ä½ç½®: Fostoria, Ohio, US</span><br><span class="line">192.36.73.247: 233 æ¬¡å°è¯• - ä½ç½®: VÃ¤xjÃ¶, Kronoberg, SE</span><br><span class="line">...</span><br></pre></td></tr></table></figure>

<p>ä»ç»Ÿè®¡çš„ç»“æœæ¥çœ‹ï¼Œæˆ‘çš„VPSç¡®å®å—åˆ°äº†å¤§é‡çš„ SSH çˆ†ç ´æ”»å‡»ï¼Œæ”»å‡»è€…é€šè¿‡ä¸æ–­å°è¯•ä¸åŒçš„ç”¨æˆ·åå’Œå¯†ç ï¼Œè¯•å›¾ä»¥SSHçš„æ–¹å¼çš„ç™»é™†ç³»ç»Ÿã€‚</p>
<h3 id="ä¸ºä»€ä¹ˆè¦æ­å»ºèœœç½"><a href="#ä¸ºä»€ä¹ˆè¦æ­å»ºèœœç½" class="headerlink" title="ä¸ºä»€ä¹ˆè¦æ­å»ºèœœç½"></a>ä¸ºä»€ä¹ˆè¦æ­å»ºèœœç½</h3><h4 id="å¯èƒ½çš„è§£å†³åŠæ³•"><a href="#å¯èƒ½çš„è§£å†³åŠæ³•" class="headerlink" title="å¯èƒ½çš„è§£å†³åŠæ³•"></a>å¯èƒ½çš„è§£å†³åŠæ³•</h4><p>å¯ä»¥åœ¨Azureçš„ç®¡ç†é¡µé¢è®¾ç½®ç½‘ç»œè§„åˆ™ï¼Œé™åˆ¶ä½¿ç”¨SSHç™»å½•çš„æºIPï¼Œå¯æ˜¯æˆ‘ä»¬ç°åœ¨ä½¿ç”¨çš„è®¾å¤‡çš„IPéƒ½æ˜¯è¢«DHCPæœåŠ¡å™¨åˆ†é…çš„ï¼Œå¯èƒ½ä¸€æ®µæ—¶é—´ä¹‹åå°±ä¼šæ”¹å˜ï¼Œä¹‹åå¦‚æœå†æƒ³ä»¥SSHçš„æ–¹å¼ç™»å½•VPSå°±åˆè¦ä¿®æ”¹ç½‘ç»œè§„åˆ™ï¼Œåœ¨è§„åˆ™ä¸Šç§»é™¤åŸåœ°å€åŠ å…¥æ–°åœ°å€ï¼Œä¸å¤ªæ–¹ä¾¿ï¼Œæ‰€ä»¥æˆ‘è¿˜æ˜¯å†³å®šä¸é™åˆ¶SSHç™»å½•çš„æºIPï¼Œå¹¶è®¾ç½®ä¸€ä¸ªæ›´å¼ºçš„å¯†ç ï¼Œé¿å…è¢«æˆåŠŸçˆ†ç ´ã€‚</p>
<p>ä¹Ÿå¯ä»¥é€šè¿‡ä¿®æ”¹<code>/etc/SSH/SSHd_config</code>æ–‡ä»¶ï¼Œé…ç½®ä¸€äº›å®‰å…¨æªæ–½ï¼š</p>
<figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">LoginGraceTime 30s        <span class="params">#</span> å°†ç™»å½•è¶…æ—¶æ—¶é—´è®¾ç½®ä¸º30ç§’</span><br><span class="line">PermitRootLogin no        <span class="params">#</span> ç¦æ­¢rootç”¨æˆ·ç™»å½•</span><br><span class="line">StrictModes yes           <span class="params">#</span> å¯ç”¨ä¸¥æ ¼æ¨¡å¼</span><br><span class="line">MaxAuthTries 3            <span class="params">#</span> å…è®¸æœ€å¤š3æ¬¡è®¤è¯å°è¯•</span><br><span class="line">MaxSessions 5             <span class="params">#</span> é™åˆ¶å•ä¸ªè¿æ¥æœ€å¤š5ä¸ªä¼šè¯</span><br></pre></td></tr></table></figure>

<p>è¿™åœ¨ä¸€å®šç¨‹åº¦ä¸Šå¯ä»¥ç¼“è§£SSHçˆ†ç ´ã€‚</p>
<p>è¿˜æœ‰ä¸€ç§åŠæ³•å°±æ˜¯å®‰è£…<code>Fail2Ban</code>å·¥å…·ï¼Œå®ƒå¯ä»¥è‡ªåŠ¨æ£€æµ‹æ—¥å¿—æ–‡ä»¶ä¸­çš„å¤±è´¥å°è¯•ï¼Œå¹¶æ ¹æ®é¢„å®šä¹‰çš„è§„åˆ™å°ç¦ç›¸åº”çš„ IP åœ°å€ã€‚</p>
<p>ä½†åé¢è¦æ­å»ºèœœç½ï¼Œæˆ‘å°±ä¿ç•™äº†åŸæ¥çš„é…ç½®ï¼Œä¹Ÿæ²¡æœ‰é…ç½®å®‰å…¨å·¥å…·ã€‚</p>
<h4 id="ä¸ºä»€ä¹ˆè¦æ­å»ºèœœç½-1"><a href="#ä¸ºä»€ä¹ˆè¦æ­å»ºèœœç½-1" class="headerlink" title="ä¸ºä»€ä¹ˆè¦æ­å»ºèœœç½"></a>ä¸ºä»€ä¹ˆè¦æ­å»ºèœœç½</h4><p>æ°å·§æˆ‘çš„æœ¬ç§‘ä¸“ä¸šæ˜¯ç½‘ç»œç©ºé—´å®‰å…¨ï¼Œäº†è§£è¿‡ä¸€äº›èœœç½çš„æ¦‚å¿µï¼Œäºæ˜¯æˆ‘è¯•ä¸€ä¸‹é€šè¿‡æ­å»ºä¸€ä¸ªSSHèœœç½æ¥æ”¶é›†æ”»å‡»è€…ä¿¡æ¯ï¼Œå°±æ˜¯å°è¯•ä½¿ç”¨ä¸€ä¸‹ã€‚</p>
<p><strong>Just for fun</strong></p>
<h2 id="èœœç½æ­å»º"><a href="#èœœç½æ­å»º" class="headerlink" title="èœœç½æ­å»º"></a>èœœç½æ­å»º</h2><p>é€‰æ‹©<a target="_blank" rel="noopener" href="https://github.com/cowrie/cowrie/blob/master/docker/docker-compose.yml">Cowrie</a>èœœç½ï¼Œå¯ä»¥ç›´æ¥æ­å»ºåœ¨VPSä¸Šï¼Œä¹Ÿå¯ä»¥é€šè¿‡Dockeræ­å»ºåœ¨å®¹å™¨ä¸Šã€‚</p>
<p>ç”±äºæˆ‘çš„VPSå¹¶ä¸ä¼šæ‰¿è½½å¤ªå¤šå·¥ä½œï¼Œæ€§èƒ½è¿˜æœ‰å¾ˆå¤šå‰©ä½™ï¼ˆè¿™é‡Œä¼ç¬”äº†ï¼Œè™½ç„¶æ˜¯å‰©äº†æ€§èƒ½ï¼Œä½†ä¸å¤šâ€¦æ‰€ä»¥å¯¼è‡´åé¢æˆ‘çš„VPSç›´æ¥å¡æ­»ï¼‰ï¼Œæ‰€ä»¥æˆ‘é€‰æ‹©å°†Cowrieæ­å»ºåœ¨Dockerå®¹å™¨ä¸Šã€‚</p>
<h3 id="å·¥ä½œå‡†å¤‡"><a href="#å·¥ä½œå‡†å¤‡" class="headerlink" title="å·¥ä½œå‡†å¤‡"></a>å·¥ä½œå‡†å¤‡</h3><p>ä¸‹è½½dockerï¼Œdocker-composeï¼Œå°†cowrieé¡¹ç›®å…‹éš†åˆ°æœ¬åœ°ã€‚</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$ docker --version</span><br><span class="line">Docker version 24.0.7, build 24.0.7-0ubuntu2~22.04.1</span><br><span class="line">$ docker-compose --version</span><br><span class="line">docker-compose version 1.29.2, build unknown</span><br><span class="line">$ <span class="built_in">ls</span></span><br><span class="line">cowrie  ip_cache.json  MySQL  ssh_login_attempts.py</span><br></pre></td></tr></table></figure>

<h3 id="ç¼–è¾‘docker-compose-yml"><a href="#ç¼–è¾‘docker-compose-yml" class="headerlink" title="ç¼–è¾‘docker-compose.yml"></a>ç¼–è¾‘docker-compose.yml</h3><p>githubé¡¹ç›®ä»£ç é‡Œæœ‰ä¸€ä»½<code>docker-compose.yml</code>ï¼Œéœ€è¦é…ç½®è¿‡åæ‰å¯ä»¥ä½¿ç”¨ï¼Œä»¥ä¸‹æ˜¯æˆ‘ä¿®æ”¹ä¹‹åçš„:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">---</span><br><span class="line">version: &#x27;3&#x27;</span><br><span class="line"></span><br><span class="line">volumes:</span><br><span class="line">  cowrie-var:</span><br><span class="line"></span><br><span class="line">services:</span><br><span class="line">  cowrie:</span><br><span class="line">    restart: always</span><br><span class="line">    build:</span><br><span class="line">      context: ./</span><br><span class="line">      dockerfile: Dockerfile</span><br><span class="line">    ports:</span><br><span class="line">      - &quot;2222:2222&quot;</span><br><span class="line">        # - &quot;2223:2223&quot;</span><br><span class="line">    volumes:</span><br><span class="line">      - ./etc:/cowrie/cowrie-git/etc</span><br><span class="line">      - cowrie-var:/cowrie/cowrie-git/var</span><br></pre></td></tr></table></figure>

<blockquote>
<p>ä¸‹é¢æ˜¯é…ç½®çš„ç®€è¦è§£é‡Šï¼š</p>
<p><strong>volumes</strong>:</p>
<ul>
<li><code>cowrie-var</code>: å®šä¹‰äº†ä¸€ä¸ª Docker å·ï¼Œç”¨äºæŒä¹…åŒ–å­˜å‚¨ã€‚</li>
</ul>
<p><strong>services</strong>:</p>
<ul>
<li><p><code>cowrie</code>: å®šä¹‰äº†ä¸€ä¸ªåä¸º <code>cowrie</code> çš„æœåŠ¡ã€‚</p>
</li>
<li><p><code>restart: always</code>: æŒ‡å®šå®¹å™¨åœ¨åœæ­¢åæ€»æ˜¯é‡æ–°å¯åŠ¨ã€‚</p>
</li>
<li><p><code>build</code>:</p>
<ul>
<li><code>context: ./</code>: è¡¨ç¤º Dockerfile ä½äºå½“å‰ç›®å½•ã€‚</li>
<li><code>dockerfile: Dockerfile</code>: æŒ‡å®š Dockerfile çš„åç§°ã€‚</li>
</ul>
</li>
<li><p><code>ports</code>:</p>
<ul>
<li><code>&quot;2222:2222&quot;</code>: å°†å®¿ä¸»æœºçš„ 2222 ç«¯å£æ˜ å°„åˆ°å®¹å™¨çš„ 2222 ç«¯å£ã€‚</li>
</ul>
</li>
<li><p><code>volumes</code>:</p>
<ul>
<li><code>./etc:/cowrie/cowrie-git/etc</code>: å°†å½“å‰ç›®å½•çš„ <code>etc</code> æ–‡ä»¶å¤¹æŒ‚è½½åˆ°å®¹å™¨å†…çš„ <code>/cowrie/cowrie-git/etc</code>ã€‚</li>
<li><code>cowrie-var:/cowrie/cowrie-git/var</code>: å°†å®šä¹‰çš„ <code>cowrie-var</code> å·æŒ‚è½½åˆ°å®¹å™¨å†…çš„ <code>/cowrie/cowrie-git/var</code>ã€‚</li>
</ul>
</li>
</ul>
</blockquote>
<p>è¿™é‡Œ<code>docker</code>ä¼šåˆ›å»ºä¸€ä¸ªåä¸º<code>cowrie-var</code>çš„å·ï¼ŒåŒæ­¥å®¹å™¨é‡Œå¯¹åº”çš„<code>var</code>æ–‡ä»¶ï¼Œä½¿å¾—å®¹å™¨é‡å¯æˆ–å®¿ä¸»æœºé‡å¯åä»ç„¶èƒ½ä¿ç•™å…³é”®æ•°æ®ã€‚èƒ½å¤Ÿä½¿ç”¨å½“å‰ç›®å½•ä¸­çš„ <code>etc</code> é…ç½®æ–‡ä»¶ï¼Œå› ä¸º<code>docker</code>å°†å½“å‰ç›®å½•ä¸‹çš„<code>cowrie/etc</code>æ–‡ä»¶æ˜ å°„åˆ°äº†å®¹å™¨ä¸­çš„<code>cowrie-git/etc</code>ä¸­ã€‚</p>
<h3 id="ç¼–è¾‘cowireé…ç½®"><a href="#ç¼–è¾‘cowireé…ç½®" class="headerlink" title="ç¼–è¾‘cowireé…ç½®"></a>ç¼–è¾‘cowireé…ç½®</h3><p>é…ç½®æ–‡ä»¶ä½äºetcç›®å½•ä¸‹ï¼ŒåŸºæœ¬ä¸Šé»˜è®¤çš„é…ç½®å°±è¶³å¤Ÿä½¿ç”¨ã€‚ç›´æ¥å¤åˆ¶æ–‡ä»¶:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cp</span> etc/cowrie.cfg.dist etc/cowrie.cfg</span><br><span class="line"><span class="built_in">cp</span> etc/userdb.example etc/userdb.txt</span><br></pre></td></tr></table></figure>

<p><code>cowrie.cfg</code> æ˜¯ Cowrie çš„ä¸»é…ç½®æ–‡ä»¶ï¼Œç”¨äºé…ç½® Cowrie çš„å„ç§é€‰é¡¹å’Œå‚æ•°ã€‚</p>
<p><code>userdb.txt</code> æ˜¯ Cowrie çš„ç”¨æˆ·æ•°æ®åº“æ–‡ä»¶ï¼Œç”¨äºå®šä¹‰ Honeypot ä¸­å¯ç”¨çš„ç”¨æˆ·åå’Œå¯†ç ã€‚</p>
<blockquote>
<p>The configuration for Cowrie is stored in cowrie.cfg.dist and cowrie.cfg (Located in cowrie&#x2F;etc). Both files are read on startup, where entries from cowrie.cfg take precedence. The .dist file can be overwritten by upgrades, cowrie.cfg will not be touched. To run with a standard configuration, there is no need to change anything.</p>
</blockquote>
<h3 id="ä½¿ç”¨docker-composeæ„å»ºå¹¶å¯åŠ¨å®¹å™¨"><a href="#ä½¿ç”¨docker-composeæ„å»ºå¹¶å¯åŠ¨å®¹å™¨" class="headerlink" title="ä½¿ç”¨docker-composeæ„å»ºå¹¶å¯åŠ¨å®¹å™¨"></a>ä½¿ç”¨<code>docker-compose</code>æ„å»ºå¹¶å¯åŠ¨å®¹å™¨</h3><p>åœ¨<code>docker-compose.yml</code>ç›®å½•ä¸‹ä½¿ç”¨<code>up</code>å‘½ä»¤å³å¯ã€‚</p>
<p>ä½†å‰å‡ æ¬¡æ„å»ºéƒ½å¤±è´¥äº†ï¼Œæ ¹æ®é”™è¯¯æç¤ºåˆåšäº†ä¸€äº›ä¿®æ”¹ï¼Œæœ€åå®¹å™¨å§‹ç»ˆéƒ½ä¸èƒ½æ­£å¸¸å·¥ä½œï¼Œåœ¨æŸ¥çœ‹<code>Dockerfile</code>ä¸­å†…å®¹åæ‰çŸ¥é“ï¼Œæ„å»ºçš„é€”ä¸­ä¼šå°†<code>Dockerfile</code>æ‰€åœ¨ç›®å½•ä¸­çš„æ‰€æœ‰æ–‡ä»¶å¤åˆ¶åˆ°<code>cowrie-git</code>ï¼Œè€Œä¸€å¼€å§‹æˆ‘æ˜¯åœ¨<code>/cowrie/docker</code>ç›®å½•ä¸‹æ“ä½œçš„ï¼Œæ‰€ä»¥æœ€åæ„å»ºå‡ºæ¥çš„å®¹å™¨çš„ç›®å½•å†…æ²¡æœ‰å¯¹åº”çš„æ–‡ä»¶ï¼Œæ‰€ä»¥å®¹å™¨ä¸èƒ½æ­£å¸¸å·¥ä½œâ€¦â€¦..</p>
<p>å› ä¸ºä¸æ˜¯å¾ˆä¼š<code>docker</code>ï¼Œæ‰€ä»¥åœ¨è¿™é‡Œèµ°äº†ä¸€äº›å²”è·¯ï¼Œæµªè´¹äº†äº›æ—¶é—´ã€‚</p>
<p>æ‰€ä»¥è§£å†³åŠæ³•å°±æ˜¯ï¼Œå°†<code>dockerfile</code>å’Œ<code>docker-compose.yml</code>éƒ½ç§»åˆ°<code>cowrie/</code>ç›®å½•ä¸‹ï¼Œå†ä½¿ç”¨<code>docker-compose</code>å‘½ä»¤å¯åŠ¨å®¹å™¨å³å¯ã€‚</p>
<p>æˆåŠŸä¹‹åä½¿ç”¨<code>docker ps </code>å‘½ä»¤æŸ¥çœ‹å®¹å™¨çŠ¶æ€ã€‚</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">~/cowrie$ sudo docker ps</span><br><span class="line">CONTAINER ID   IMAGE           COMMAND                  CREATED          STATUS          PORTS                                                  NAMES</span><br><span class="line">039b3420c979   cowrie_cowrie   <span class="string">&quot;/cowrie/cowrie-env/â€¦&quot;</span>   7 hours ago      Up 46 minutes   0.0.0.0:2222-&gt;2222/tcp, :::2222-&gt;2222/tcp, 2223/tcp    cowrie_cowrie_1</span><br></pre></td></tr></table></figure>

<h3 id="é…ç½®MySQLæ•°æ®åº“"><a href="#é…ç½®MySQLæ•°æ®åº“" class="headerlink" title="é…ç½®MySQLæ•°æ®åº“"></a>é…ç½®MySQLæ•°æ®åº“</h3><p>äº†è§£åˆ°<code>cowrie</code>æ”¯æŒå°†æ”¶é›†åˆ°çš„ä¿¡æ¯å­˜å‚¨åˆ°MySQLä¸­ï¼Œä¾¿äºæŸ¥çœ‹ï¼Œäºæ˜¯æˆ‘åˆå°è¯•æ„å»ºä¸€ä¸ªMySQLæœåŠ¡ã€‚</p>
<p>ä½†æ˜¯å¦‚æœè¦è¿æ¥MySQLçš„è¯ï¼Œéœ€è¦è¿è¡Œ<code>cowrie</code>çš„å®¹å™¨è¿æ¥æˆ‘æœåŠ¡å™¨çš„ç«¯å£ï¼Œæˆ‘å°†<code>cowrie</code>éƒ¨ç½²åˆ°dockerä¸Šè€Œä¸æ˜¯æœåŠ¡å™¨ä¸Šçš„æœ¬æ„å°±æ˜¯é˜²æ­¢<code>cowrie</code>çš„å¯èƒ½çš„æ¼æ´ä¼šä½¿å¾—æœåŠ¡å™¨é¢ä¸´å±é™©ï¼Œä½†æ˜¯å¦‚æœ<code>cowrie</code>è¦è¿æ¥æœåŠ¡å™¨çš„ç«¯å£ï¼Œè¿™åˆå°†<code>cowrie</code>å’ŒæœåŠ¡å™¨è¿æ¥èµ·æ¥äº†â€¦.ä¸æˆ‘çš„æœ¬æ„åˆå†²çªäº†ã€‚</p>
<p>æ‰€ä»¥æˆ‘æƒ³é€šè¿‡dockerå®¹å™¨çš„æ–¹å¼è¿è¡Œä¸€ä¸ªæ•°æ®åº“æœåŠ¡ï¼Œäºæ˜¯æˆ‘åˆé€šè¿‡<code>docker-compose</code>çš„æ–¹å¼æ„å»ºå¹¶è¿è¡Œäº†ä¸€ä¸ªMySQLæœåŠ¡çš„dockerå®¹å™¨ã€‚</p>
<p>è¿™æ˜¯æˆ‘çš„<code>docker-compose.yml</code>æ–‡ä»¶å†…å®¹ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">version: &#x27;3.8&#x27;</span><br><span class="line"></span><br><span class="line">services:</span><br><span class="line">  MySQL:</span><br><span class="line">    image: MySQL:8.0</span><br><span class="line">    container_name: MySQL_container</span><br><span class="line">    restart: always</span><br><span class="line">    environment:</span><br><span class="line">      # (rootè´¦æˆ·çš„å¯†ç )</span><br><span class="line">      MySQL_ROOT_PASSWORD: *****  </span><br><span class="line">      MySQL_DATABASE: cowire</span><br><span class="line">    ports:</span><br><span class="line">      - &quot;3306:3306&quot;</span><br><span class="line">    volumes:</span><br><span class="line">      - MySQL_data:/var/lib/MySQL</span><br><span class="line"></span><br><span class="line">volumes:</span><br><span class="line">  MySQL_data:</span><br></pre></td></tr></table></figure>

<p>æ„å»ºå¥½åä¹‹åï¼Œä½¿ç”¨<code>docker ps</code>å‘½ä»¤æŸ¥çœ‹ï¼Œå·²ç»å¼€å¯äº†ä¸¤ä¸ªå®¹å™¨ï¼Œå¹¶ä¸”æ­£å¸¸è¿è¡Œã€‚</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">~/MySQL$ sudo docker ps</span><br><span class="line">CONTAINER ID   IMAGE           COMMAND                  CREATED             STATUS             PORTS                                                  NAMES</span><br><span class="line">dfb2032ec83c   MySQL:8.0       <span class="string">&quot;docker-entrypoint.sâ€¦&quot;</span>   About an hour ago   Up About an hour   0.0.0.0:3306-&gt;3306/tcp, :::3306-&gt;3306/tcp, 33060/tcp   MySQL_container</span><br><span class="line">039b3420c979   cowrie_cowrie   <span class="string">&quot;/cowrie/cowrie-env/â€¦&quot;</span>   7 hours ago         Up 59 minutes      0.0.0.0:2222-&gt;2222/tcp, :::2222-&gt;2222/tcp, 2223/tcp    cowrie_cowrie_1</span><br></pre></td></tr></table></figure>

<p>ç„¶ååœ¨VPSä¸Šå†ä¸‹è½½ä¸€ä¸ªMySQLå®¢æˆ·ç«¯ï¼Œä½¿ç”¨ä»¥ä¸‹å‘½ä»¤ç„¶åå†è¾“å…¥å¯†ç å°±å¯ä»¥è¿æ¥åˆ°å®¹å™¨çš„æ•°æ®åº“æœåŠ¡äº†ã€‚</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">MySQL -h 127.0.0.1 -u root -p</span><br></pre></td></tr></table></figure>

<blockquote>
<p>è¿™é‡Œä¸èƒ½çœç•¥ -h 127.0.0.1 ï¼Œå› ä¸ºå¦‚æœçœç•¥å°±ä»£è¡¨ç”¨localhostï¼Œè™½ç„¶ä¹Ÿæ˜¯è¿™ä¸ªIPåœ°å€ï¼Œä½†æ˜¯ç³»ç»Ÿä¼šé»˜è®¤ä½¿ç”¨Unix socketè¿›è¡Œè¿æ¥ï¼Œè€Œä¸ä¼šç”¨TCPçš„æ–¹å¼è¿›è¡Œè¿æ¥ã€‚</p>
<p>ç”¨Unix socketä¼šæŠ¥é”™ã€‚</p>
<hr>
<p><strong>Unix Socketé€šä¿¡åŸç†</strong></p>
<p>Unix socket ä»…åœ¨æœ¬åœ°è®¡ç®—æœºä¸Šä½¿ç”¨ï¼Œä¸æ¶‰åŠç½‘ç»œä¼ è¾“ã€‚å®ƒé€šè¿‡æ–‡ä»¶ç³»ç»Ÿä¸­çš„ä¸€ä¸ªç‰¹æ®Šæ–‡ä»¶æ¥è¿›è¡Œé€šä¿¡ï¼Œè€Œä¸æ˜¯é€šè¿‡ç½‘ç»œæ¥å£ã€‚</p>
<p>ä½¿ç”¨æ–‡ä»¶ç³»ç»Ÿä¸­çš„ä¸€ä¸ªç‰¹æ®Šæ–‡ä»¶ä½œä¸ºé€šä¿¡çš„ç«¯ç‚¹ã€‚è¿™ä¸ªæ–‡ä»¶é€šå¸¸ä½äº <code>/tmp</code> æˆ– <code>/var/run</code> ç­‰ç›®å½•ä¸­ï¼Œä¾‹å¦‚ <code>/var/run/MySQL/MySQL.sock</code>ã€‚å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨è¿›ç¨‹é€šè¿‡è¿™ä¸ªæ–‡ä»¶è¿›è¡Œè¯»å†™æ“ä½œã€‚</p>
<p>æœ‰ä»¥ä¸‹ä¸‰ç§<strong>ç±»å‹</strong></p>
<ul>
<li><strong>Stream Sockets</strong>ï¼ˆæµå¥—æ¥å­—ï¼‰ï¼šæä¾›é¢å‘è¿æ¥çš„ã€å¯é çš„å­—èŠ‚æµé€šä¿¡ã€‚ç±»ä¼¼äºç½‘ç»œä¸­çš„ TCPã€‚</li>
<li><strong>Datagram Sockets</strong>ï¼ˆæ•°æ®æŠ¥å¥—æ¥å­—ï¼‰ï¼šæä¾›æ— è¿æ¥çš„ã€ç‹¬ç«‹çš„æ•°æ®æŠ¥é€šä¿¡ã€‚ç±»ä¼¼äºç½‘ç»œä¸­çš„ UDPã€‚</li>
<li><strong>Raw Sockets</strong>ï¼ˆåŸå§‹å¥—æ¥å­—ï¼‰ï¼šæä¾›å¯¹åº•å±‚ç½‘ç»œåè®®çš„è®¿é—®ï¼Œé€šå¸¸ä¸ç”¨äºä¸€èˆ¬åº”ç”¨ç¨‹åºã€‚</li>
</ul>
<p><strong>é€šä¿¡è¿‡ç¨‹</strong>ï¼š</p>
<ul>
<li><strong>æœåŠ¡å™¨</strong>ï¼šåœ¨æŒ‡å®šçš„ Unix socket æ–‡ä»¶è·¯å¾„ä¸Šç›‘å¬å®¢æˆ·ç«¯çš„è¿æ¥è¯·æ±‚ã€‚æœåŠ¡å™¨è¿›ç¨‹åˆ›å»ºä¸€ä¸ª Unix socketï¼Œå¹¶å°†å…¶ç»‘å®šåˆ°ä¸€ä¸ªæ–‡ä»¶è·¯å¾„ä¸Šã€‚ç„¶åï¼Œå®ƒä¼šç›‘å¬æ¥è‡ªå®¢æˆ·ç«¯çš„è¿æ¥è¯·æ±‚ã€‚</li>
<li><strong>å®¢æˆ·ç«¯</strong>ï¼šé€šè¿‡è®¿é—®æœåŠ¡å™¨æŒ‡å®šçš„ Unix socket æ–‡ä»¶æ¥è¿æ¥æœåŠ¡å™¨ã€‚å®¢æˆ·ç«¯è¿›ç¨‹æ‰“å¼€è¿™ä¸ªæ–‡ä»¶å¹¶ä¸æœåŠ¡å™¨å»ºç«‹é€šä¿¡ã€‚</li>
</ul>
<p><strong>ä¼˜ç‚¹</strong>ï¼š</p>
<ul>
<li><strong>é«˜æ•ˆ</strong>ï¼šç”±äº Unix socket ä¸æ¶‰åŠç½‘ç»œåè®®æ ˆï¼Œå®ƒä»¬<strong>åœ¨åŒä¸€å°æœºå™¨ä¸Šè¿›è¡Œè¿›ç¨‹é—´é€šä¿¡</strong>æ—¶æ¯”ç½‘ç»œå¥—æ¥å­—æ›´é«˜æ•ˆã€‚</li>
<li><strong>å®‰å…¨æ€§</strong>ï¼šUnix socket æ–‡ä»¶çš„æƒé™å¯ä»¥æ§åˆ¶è®¿é—®ï¼Œè¿›ç¨‹ä¹‹é—´çš„é€šä¿¡å¯ä»¥æ›´åŠ å®‰å…¨ã€‚</li>
</ul>
<hr>
<p>chatGPTï¼š</p>
<p><strong>åŒºåˆ«è§£æ</strong></p>
<ol>
<li><p><strong><code>-h 127.0.0.1</code></strong></p>
<p>å½“ä½ ä½¿ç”¨ <code>-h 127.0.0.1</code> æ—¶ï¼ŒMySQL å®¢æˆ·ç«¯é€šè¿‡ TCP&#x2F;IP åè®®è¿æ¥åˆ° MySQL æœåŠ¡ã€‚è¿™æ˜¯å› ä¸º <code>127.0.0.1</code> æ˜ç¡®æŒ‡å®šäº†ä½¿ç”¨ TCP&#x2F;IP è¿æ¥ï¼Œå¹¶ä¸”ä½ å·²æ­£ç¡®æ˜ å°„äº†å®¹å™¨çš„ç«¯å£åˆ°æœ¬åœ°ç«¯å£ã€‚</p>
</li>
<li><p><strong><code>-h localhost</code></strong></p>
<p>å½“ä½ ä½¿ç”¨ <code>-h localhost</code> æ—¶ï¼ŒMySQL å®¢æˆ·ç«¯é»˜è®¤å°è¯•é€šè¿‡ Unix socket è¿›è¡Œè¿æ¥ã€‚åœ¨ Linux ç³»ç»Ÿä¸Šï¼Œ<code>localhost</code> é€šå¸¸æŒ‡çš„æ˜¯ä¸€ä¸ª Unix socket æ–‡ä»¶ã€‚å› ä¸º Docker å®¹å™¨å’Œä¸»æœºç³»ç»Ÿçš„ Unix socket æ–‡ä»¶ç³»ç»Ÿæ˜¯éš”ç¦»çš„ï¼Œæ‰€ä»¥å®¢æˆ·ç«¯å°è¯•é€šè¿‡ Unix socket è¿æ¥æ—¶ä¼šå¤±è´¥ï¼Œå°¤å…¶æ˜¯åœ¨å®¹å™¨å†…è¿è¡Œçš„æœåŠ¡æ— æ³•æ˜ å°„åˆ°ä¸»æœºçš„ Unix socket ä¸Šã€‚</p>
</li>
</ol>
</blockquote>
<p>å†æ ¹æ®<code>cowrie</code>å®˜æ–¹æ–‡æ¡£çš„æŒ‡ç¤ºï¼Œæœ€å¥½ä¸º<code>cowrie</code>åˆ›å»ºä¸“é—¨çš„æ•°æ®åº“ï¼Œå¹¶ä¸”åˆ›å»ºä¸€ä¸ªä¸“é—¨ç”¨äºç®¡ç†è¯¥æ•°æ®åº“çš„ç”¨æˆ·ï¼ˆæƒé™ç®¡ç†ï¼‰ã€‚</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">USER</span> <span class="string">&#x27;cowrie&#x27;</span>@<span class="string">&#x27;$IP&#x27;</span> IDENTIFIED <span class="keyword">BY</span> <span class="string">&#x27;********&#x27;</span>;</span><br><span class="line"><span class="keyword">GRANT</span> <span class="keyword">INSERT</span>, <span class="keyword">SELECT</span>, <span class="keyword">UPDATE</span> <span class="keyword">ON</span> cowrie.<span class="operator">*</span> <span class="keyword">TO</span> <span class="string">&#x27;cowrie&#x27;</span>@<span class="string">&#x27;$IP&#x27;</span>;</span><br><span class="line">FLUSH PRIVILEGES;</span><br></pre></td></tr></table></figure>

<p>é€šè¿‡ä¸Šé¢çš„å‘½ä»¤ï¼Œæˆ‘åˆ›å»ºäº†å¯†ç ä¸º<code>********</code>çš„ç”¨æˆ·<code>cowrie</code>ï¼Œå¹¶è§„å®šäº†ç™»å½•çš„IPåœ°å€å’Œæƒé™ã€‚</p>
<blockquote>
<p>è¿™é‡Œçš„$IPï¼Œä¸€å®šæ˜¯VPSå¯¹äºMySQLå®¹å™¨çš„IPåœ°å€ï¼Œå› ä¸ºè¿™é‡Œåšçš„æ˜¯æœ¬æœºåˆ°æœåŠ¡å™¨çš„æ˜ å°„ï¼Œå¦‚æœè®¾ç½®æˆlocalhostæˆ–è€…æ˜¯127.0.0.1å°±ä¼šå¯¼è‡´ç™»é™†å¤±è´¥ã€‚</p>
<p>è¦æ‰¾åˆ°è¿™ä¸ªå¯¹åº”çš„IPåœ°å€ï¼Œå°±å…ˆè¦æ‰¾åˆ°MySQLå®¹å™¨æ‰€å¯¹åº”çš„ç½‘åŸŸã€‚ï¼ˆæŸ¥çœ‹dockerå®¹å™¨çš„ç½‘ç»œé…ç½®ï¼‰</p>
</blockquote>
<p>ç„¶ååˆ›å»º<code>cowrie</code>æ•°æ®åº“ï¼Œå¹¶åœ¨è¯¥åº“ä¸­æ‰§è¡Œ<code>/cowrie/docs/sql/MySQL.sql</code>è„šæœ¬ï¼Œåˆ›å»ºå¯¹åº”çš„è¡¨ã€‚</p>
<p>æœ€åè¿˜éœ€è¦åœ¨<code>cowrie/etc/cowrie.cfg</code>é…ç½®æ–‡ä»¶ä¸­ï¼Œæ‰¾åˆ°<code>output_MySQL</code>æ¨¡å—ï¼Œåšå¦‚ä¸‹ä¿®æ”¹ã€‚</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[<span class="string">output_MySQL</span>]</span><br><span class="line"><span class="string">enabled</span> <span class="string">=</span> <span class="literal">true</span></span><br><span class="line"><span class="comment"># VPSå¯¹äºcowrieå®¹å™¨çš„IPåœ°å€</span></span><br><span class="line"><span class="string">host</span> <span class="string">=</span> <span class="string">$IP</span>    </span><br><span class="line"><span class="string">database</span> <span class="string">=</span> <span class="string">cowrie</span></span><br><span class="line"><span class="string">username</span> <span class="string">=</span> <span class="string">cowrie</span></span><br><span class="line"><span class="comment"># å¡«å†™ç»™cowrieè®¾ç½®çš„å¯†ç </span></span><br><span class="line"><span class="string">password</span> <span class="string">=</span> <span class="string">********</span></span><br><span class="line"><span class="string">port</span> <span class="string">=</span> <span class="number">3306</span></span><br><span class="line"><span class="string">debug</span> <span class="string">=</span> <span class="literal">false</span></span><br></pre></td></tr></table></figure>

<p>è¿™æ ·å°±æˆåŠŸäº†ï¼Œé‡æ–°æ„å»ºå®¹å™¨å¹¶å¯åŠ¨å³å¯ã€‚</p>
<p>ç°åœ¨ä½¿ç”¨ä¸‹é¢çš„å‘½ä»¤</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SSH root@localhost -p 2222</span><br></pre></td></tr></table></figure>

<p>å³å¯åœ¨æœ¬åœ°è®¿é—®<code>cowrie</code>èœœç½è¿›ç¨‹ï¼Œè¯¥è¿›ç¨‹ä¼šè®°å½•æ¯ä¸€æ¬¡æ“ä½œå¹¶å†™å…¥MySQLæ•°æ®åº“ä¸­ã€‚</p>
<h3 id="é‡æ–°é…ç½®ç«¯å£"><a href="#é‡æ–°é…ç½®ç«¯å£" class="headerlink" title="é‡æ–°é…ç½®ç«¯å£"></a>é‡æ–°é…ç½®ç«¯å£</h3><p>ä¸ºäº†æ•è·å¤–éƒ¨å¯¹SSHæœåŠ¡çš„çˆ†ç ´ï¼Œè¿˜éœ€è¦å®Œæˆæœ€åä¸€æ­¥ï¼šå°†22ç«¯å£é‡å®šå‘åˆ°2222ç«¯å£å¹¶å°†SSHè¿æ¥æ›´æ”¹åˆ°å¦ä¸€ä¸ªç«¯å£ã€‚</p>
<h4 id="ä¿®æ”¹SSHé…ç½®æ–‡ä»¶ä»¥å¯ç”¨æ–°çš„ç«¯å£"><a href="#ä¿®æ”¹SSHé…ç½®æ–‡ä»¶ä»¥å¯ç”¨æ–°çš„ç«¯å£" class="headerlink" title="ä¿®æ”¹SSHé…ç½®æ–‡ä»¶ä»¥å¯ç”¨æ–°çš„ç«¯å£"></a>ä¿®æ”¹SSHé…ç½®æ–‡ä»¶ä»¥å¯ç”¨æ–°çš„ç«¯å£</h4><p>ä¿®æ”¹<code>/etc/SSH/SSHd_config</code>æ–‡ä»¶ï¼Œåœ¨åŸæœ¬çš„<code>Port 22</code>ä¸Šå†æ·»åŠ ä¸€ä¸ªç«¯å£ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Port 22</span><br><span class="line">Port *****</span><br></pre></td></tr></table></figure>

<p>ç„¶åä½¿ç”¨<code>sudo systemctl restart SSH</code> é‡å¯SSHæœåŠ¡ã€‚</p>
<blockquote>
<p>è®°å¾—åœ¨Azureç®¡ç†ç•Œé¢çš„å…¥æ ˆç«¯å£è§„åˆ™åšä¸€ä¸‹ä¿®æ”¹ã€‚</p>
<hr>
<p>å¦‚æœé…ç½®å‡ºäº†é—®é¢˜å¯¼è‡´æ— æ³•è¿æ¥åˆ°VPSï¼Œè¿˜å¯ä»¥é€šè¿‡åœ¨Azureç®¡ç†ç•Œé¢ç›´æ¥å‘VPSè¿è¡Œbashè„šæœ¬çš„æ–¹å¼æ¢å¤SSHé…ç½®ã€‚</p>
</blockquote>
<h4 id="é…ç½®iptablesè¿›è¡Œç«¯å£é‡å®šå‘"><a href="#é…ç½®iptablesè¿›è¡Œç«¯å£é‡å®šå‘" class="headerlink" title="é…ç½®iptablesè¿›è¡Œç«¯å£é‡å®šå‘"></a>é…ç½®iptablesè¿›è¡Œç«¯å£é‡å®šå‘</h4><p>æ·»åŠ ä¸€æ¡è§„åˆ™ï¼Œå°†22ç«¯å£çš„æ‰€æœ‰æµé‡é‡å®šå‘åˆ°2222ç«¯å£ï¼Œä¹Ÿå°±æ˜¯SSHèœœç½ç›‘å¬çš„ç«¯å£ã€‚</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo iptables -t nat -A PREROUTING -p tcp --dport 22 -j REDIRECT --to-port 2222</span><br></pre></td></tr></table></figure>

<p>ä¿å­˜iptablesè§„åˆ™ï¼Œä½¿å…¶åœ¨é‡å¯åä»ç„¶æœ‰æ•ˆ</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo sh -c <span class="string">&quot;iptables-save &gt; /etc/iptables/rules.v4&quot;</span></span><br></pre></td></tr></table></figure>

<p>è¿™æ ·ï¼Œå¤–éƒ¨è®¿é—®VPSçš„22å·ç«¯å£å°±ä¼šè®¿é—®åˆ°èœœç½ç¨‹åºçš„å‡çš„SSHæœåŠ¡ï¼ŒçœŸæ­£çš„SSHæœåŠ¡å¼€æ”¾åœ¨æˆ‘ä»¬åˆšæ‰è®¾ç½®çš„å¦å¤–çš„ç«¯å£ä¸Šï¼Œå¦‚æœè¦é€šè¿‡SSHè¿œç¨‹è¿æ¥VPSï¼Œå°±éœ€è¦æŒ‡å®šæ­£ç¡®çš„ç«¯å£ã€‚</p>
<blockquote>
<p>æœ€åæˆ‘è¿˜æ˜¯å¼ƒç”¨äº†iptables</p>
<p>â€“ 2024-7-29</p>
</blockquote>
<h3 id="æ•ˆæœ"><a href="#æ•ˆæœ" class="headerlink" title="æ•ˆæœ"></a>æ•ˆæœ</h3><p>ä¸ºäº†ä¾¿äºæŸ¥çœ‹ï¼Œæˆ‘åœ¨Azureç®¡ç†ç•Œé¢é…ç½®äº†3306ç«¯å£çš„é™åˆ¶ï¼Œç°åœ¨æˆ‘å¯ä»¥åœ¨è‡ªå·±çš„ç¬”è®°æœ¬ä¸Šä½¿ç”¨navicatè¿æ¥è¯¥æ•°æ®åº“ã€‚</p>
<p>ï¼ˆä½†æ˜¯æŸ¥è¯¢çš„é€Ÿåº¦æœ‰ç‚¹æ…¢â€¦.åº”è¯¥æ˜¯å› ä¸ºæˆ‘çš„æœåŠ¡å™¨é…ç½®å¤ªå·®äº†ï¼‰</p>
<p><a href="/../img/VPS-ssh-honeypot/image-20240728213230501.png" title="image-20240728213230501" class="gallery-item" style="box-shadow: none;"> <img src="/../img/VPS-ssh-honeypot/image-20240728213230501.png" alt="image-20240728213230501"></a></p>
<p>å¯ä»¥çœ‹åˆ°ï¼Œå·²ç»æœ‰å¾ˆå¤šå°è¯•çˆ†ç ´SSHçš„è¿æ¥äº†ã€‚</p>
<p>è¿‡å‡ å¤©å†æ›´æ–°ä¸€ä¸‹æ”¶é›†æ•°æ®çš„æƒ…å†µã€‚</p>
<h2 id="å‚è€ƒæ–‡æ¡£"><a href="#å‚è€ƒæ–‡æ¡£" class="headerlink" title="å‚è€ƒæ–‡æ¡£"></a>å‚è€ƒæ–‡æ¡£</h2><p><a target="_blank" rel="noopener" href="https://cowrie.readthedocs.io/en/latest/index.html">Cowrie å®˜æ–¹æ–‡æ¡£</a></p>
<p><a target="_blank" rel="noopener" href="https://qingguojun.com/webmaster-SSH-honeypot/">ç«™é•¿æ‰‹å†Œï¼ˆäºŒï¼‰æœåŠ¡å™¨å®‰å…¨ä¹‹SSHèœœç½ | é’æœå›çš„å°ç«™ (qingguojun.com)</a></p>
</div>
    </div>

    <div class="post-meta">
        <i>
        
            <span>2024-07-27</span>
            
                <span>è¯¥ç¯‡æ–‡ç« è¢« jay1an</span>
            
            
                <span>æ‰“ä¸Šæ ‡ç­¾:
                    
                    
                        <a href='/tags/%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8/'>
                            ç½‘ç»œå®‰å…¨
                        </a>
                    
                        <a href='/tags/VPS/'>
                            VPS
                        </a>
                    
                        <a href='/tags/SSH/'>
                            SSH
                        </a>
                    
                </span>
             
             
                <span>å½’ä¸ºåˆ†ç±»:
                    
                    
                        <a href='/categories/VPS/'>
                            VPS
                        </a>
                    
                </span>
            
        
        </i>
    </div>
    <br>
    
    
        
            
    
            <div class="post-footer-pre-next">
                
                    <span>ä¸Šä¸€ç¯‡ï¼š<a href='/2024/07/28/VPS-Swap/'>VPSè®¾ç½®Swap</a></span>
                

                
                    <span class="post-footer-pre-next-last-span-right">ä¸‹ä¸€ç¯‡ï¼š<a href="/2024/07/26/coding-practice-1/">åˆ·é¢˜æ—¥è®° - 1</a>
                    </span>
                
            </div>
    
        
    

    
        

     
</div>



                                      
                    
                    
                    <div class="footer">
    
        <span> 
            Â© 1949-2024 Jay1an 

            
                

            
        </span>
       
    
</div>



<!--è¿™æ˜¯æŒ‡ä¸€æ¡çº¿å¾€ä¸‹çš„å†…å®¹-->
<div class="footer-last">
    
            <span>ä»å¤´åŠªåŠ›ä¹Ÿåå·</span>
            
                <span class="footer-last-span-right"><i>æœ¬ç«™ç”±<a target="_blank" rel="noopener" href="https://hexo.io/zh-cn/index.html">Hexo</a>é©±åŠ¨ï½œä½¿ç”¨<a target="_blank" rel="noopener" href="https://github.com/HiNinoJay/hexo-theme-A4">Hexo-theme-A4</a>ä¸»é¢˜</i></span>
            
    
</div>


    
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.0/jquery.min.js"></script>

    <!--ç›®å½•-->
    
        <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/1.7.2/jquery.min.js" type="text/javascript" ></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/jqueryui/1.12.1/jquery-ui.min.js" type="text/javascript" ></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.tocify/1.9.0/javascripts/jquery.tocify.min.js" type="text/javascript" ></script>
        
<script src="/js/toc.js"></script>

    

    
<script src="/js/randomHeaderContent.js"></script>

    <!--å›åˆ°é¡¶éƒ¨æŒ‰é’®-->
    
        
<script src="/js/returnToTop.js"></script>

    

    
        
<script src="/js/returnToLastPage.js"></script>

    





<script src="/js/lightgallery/lightgallery.umd.min.js"></script>



<script src="/js/lightgallery/plugins/lg-thumbnail.umd.min.js"></script>



<script src="/js/lightgallery/plugins/lg-fullscreen.umd.min.js"></script>


<script src="/js/lightgallery/plugins/lg-autoplay.umd.min.js"></script>


<script src="/js/lightgallery/plugins/lg-zoom.umd.min.js"></script>


<script src="/js/lightgallery/plugins/lg-rotate.umd.min.js"></script>


<script src="/js/lightgallery/plugins/lg-paper.umd.min.js"></script>




<script type="text/javascript">
     
    if (typeof lightGallery !== "undefined") {
        var options1 = {
            selector: '.gallery-item',
            plugins: [lgThumbnail, lgFullscreen, lgAutoplay, lgZoom, lgRotate, lgPager], // å¯ç”¨æ’ä»¶
            thumbnail: true,          // æ˜¾ç¤ºç¼©ç•¥å›¾
            zoom: true,               // å¯ç”¨ç¼©æ”¾åŠŸ
            rotate: true,             // å¯ç”¨æ—‹è½¬åŠŸèƒ½èƒ½
            autoplay: true,        // å¯ç”¨è‡ªåŠ¨æ’­æ”¾åŠŸèƒ½
            fullScreen: true,      // å¯ç”¨å…¨å±åŠŸèƒ½
            pager: false, //é¡µç ,
            zoomFromOrigin: true,   // ä»åŸå§‹ä½ç½®ç¼©æ”¾
            actualSize: true,       // å¯ç”¨æŸ¥çœ‹å®é™…å¤§å°çš„åŠŸèƒ½
            enableZoomAfter: 300,    // å»¶è¿Ÿç¼©æ”¾ï¼Œç¡®ä¿å›¾ç‰‡åŠ è½½å®Œæˆåå¯ç¼©æ”¾
        };
        lightGallery(document.getElementsByClassName('.article-gallery')[0], options1); // ä¿®å¤é€‰æ‹©å™¨
    }
    
</script>


    <script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script> 

                </div>
            
            
                <!-- å›åˆ°é¡¶éƒ¨çš„æŒ‰é’®-->  
                <div class="progress-wrap shadow-drop-2-bottom">
                    <svg class="progress-circle svg-content" width="100%" height="100%" viewBox="-1 -1 102 102">
                        <path d="M50,1 a49,49 0 0,1 0,98 a49,49 0 0,1 0,-98"/>
                    </svg>
                </div>
            
            
                <!-- è¿”å›çš„æŒ‰é’®-->  
                <div class="return-to-last-progress-wrap shadow-drop-2-bottom">
                    <svg class="progress-circle svg-content" width="100%" height="100%" viewBox="-1 -1 102 102">
                        <path d="M50,1 a49,49 0 0,1 0,98 a49,49 0 0,1 0,-98"/>
                    </svg>
                </div>
            
    </body>
</html>